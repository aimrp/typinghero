<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>打字英雄 - 趣味中文练习</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffe0f0, #e0f0ff);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 20px;
      overflow-x: hidden;
    }

    /* Logo 区域 - 修改为 Flex 布局以容纳 Combo */
    .header-area {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      margin-bottom: 10px; /* 20px -> 10px */
      position: relative;
      width: 100%;
      max-width: 1200px;
    }

    .app-logo {
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    /* 连击特效容器 - 移到 Header 区域 */
    .combo-container {
      position: relative; /* 改为相对定位 */
      top: auto;
      right: auto;
      pointer-events: none;
      text-align: left;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 120px;
      opacity: 0; /* 默认隐藏 */
      transition: opacity 0.3s ease;
    }
    
    .combo-container.visible {
      opacity: 1;
    }

    .combo-count {
      font-family: 'Impact', sans-serif;
      font-size: 60px;
      font-weight: 900;
      color: #ff5722;
      line-height: 1;
      text-shadow: 
        3px 3px 0px #fff, 
        6px 6px 0px #3e2723,
        0 0 20px rgba(255, 87, 34, 0.5);
      transform: scale(1); /* 默认显示 */
      transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      opacity: 0.3; /* 初始低透明度 */
    }
    
    .combo-count.active {
      opacity: 1;
    }

    .combo-count.pop {
      transform: scale(1.3) rotate(-5deg);
    }

    .combo-label {
      font-size: 24px;
      color: #795548;
      font-weight: bold;
      text-transform: uppercase;
      opacity: 0.5;
      transition: opacity 0.2s;
      margin-top: 0;
      text-shadow: 1px 1px 0 #fff;
    }
    
    .combo-container.active .combo-label {
      opacity: 1;
      color: #ff5722;
    }

    /* 连击燃烧效果 */
    .combo-fire {
      position: absolute;
      top: -20px;
      right: -20px;
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, rgba(255,87,34,0.4) 0%, rgba(255,235,59,0) 70%);
      border-radius: 50%;
      filter: blur(10px);
      z-index: -1;
      opacity: 0;
      animation: pulse-fire 0.5s infinite alternate;
    }
    
    .combo-container.burning .combo-fire {
      opacity: 1;
    }
    
    @keyframes pulse-fire {
      from { transform: scale(1); opacity: 0.5; }
      to { transform: scale(1.2); opacity: 0.8; }
    }

    /* 烟花 Canvas */
    #fireworks {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }

    /* 音频控制 */
    .audio-controls {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1001;
    }

    .icon-btn {
      background: rgba(255, 255, 255, 0.5);
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 10px;
      border-radius: 50%;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .icon-btn:hover {
      background: white;
      transform: scale(1.1);
    }
    .icon-btn.off {
      opacity: 0.5;
      filter: grayscale(100%);
    }

    /* 仪表盘 */
    .dashboard {
      display: flex;
      justify-content: space-around;
      margin-bottom: 10px; /* 减少底部边距 */
      background: rgba(255, 255, 255, 0.6);
      padding: 15px 20px; 
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.05);
      backdrop-filter: blur(10px);
      align-items: center;
      width: 100%;
      max-width: 1200px; 
    }

    /* Combo 进度条区域 */
    .combo-progress-area {
      width: 100%;
      max-width: 1200px;
      height: 30px; /* 给火箭留出空间 */
      margin-bottom: 20px;
      position: relative;
      display: flex;
      align-items: center;
    }

    .combo-track {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 3px;
      position: relative;
      overflow: visible; /* 允许火箭溢出 */
    }

    .combo-bar {
      height: 100%;
      background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 50%, #fbc2eb 100%);
      border-radius: 3px;
      width: 0%;
      transition: width 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      position: relative;
      box-shadow: 0 0 10px rgba(255, 154, 158, 0.5);
    }

    /* 进度条流光效果 */
    .combo-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
      transform: translateX(-100%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      100% { transform: translateX(100%); }
    }

    .combo-rocket {
      position: absolute;
      top: 50%;
      right: -12px; /* 火箭中心对齐进度条末端 */
      transform: translateY(-50%) rotate(45deg);
      font-size: 20px;
      filter: drop-shadow(0 0 5px rgba(255, 87, 34, 0.6));
      transition: transform 0.3s;
      z-index: 10;
    }

    /* 火箭尾焰 */
    .combo-rocket::before {
      content: '';
      position: absolute;
      bottom: -5px;
      left: -5px;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #ffeb3b, #ff5722, transparent);
      border-radius: 50%;
      filter: blur(2px);
      opacity: 0;
      transition: opacity 0.2s;
      animation: rocket-fire 0.2s infinite alternate;
    }

    .combo-progress-area.active .combo-rocket::before {
      opacity: 1;
    }

    @keyframes rocket-fire {
      from { transform: scale(0.8); }
      to { transform: scale(1.2); }
    }

    .combo-milestone {
      position: absolute;
      top: 50%; /* 垂直居中 */
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 5; /* 在进度条之上 */
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .milestone-marker {
      width: 16px;
      height: 16px;
      background: #eee;
      border: 3px solid #fff;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 5px;
      transition: all 0.3s;
      position: relative;
    }

    .milestone-text {
      font-size: 12px;
      color: #999;
      font-weight: bold;
      transition: all 0.3s;
      background: rgba(255,255,255,0.8);
      padding: 2px 6px;
      border-radius: 10px;
    }

    /* 激活态：到达里程碑 */
    .combo-milestone.reached .milestone-marker {
      background: #ffeb3b;
      border-color: #ff9800;
      transform: scale(1.5);
      box-shadow: 0 0 15px #ff9800, inset 0 0 5px #fff;
    }

    .combo-milestone.reached .milestone-text {
      color: #ff5722;
      transform: scale(1.2);
      text-shadow: 0 0 5px rgba(255, 87, 34, 0.3);
    }

    /* 光环动画 */
    .combo-milestone.reached .milestone-marker::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      border: 2px solid #ff9800;
      border-radius: 50%;
      opacity: 0;
      animation: ripple 1.5s infinite;
    }

    @keyframes ripple {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }

    /* 终点大奖杯 */
    .combo-milestone.trophy .milestone-marker {
      width: 24px;
      height: 24px;
      background: #ffd700; /* 金色 */
      border-color: #fffacd;
    }

    .combo-milestone.trophy.reached .milestone-marker {
      background: radial-gradient(circle, #fff, #ffd700);
      box-shadow: 0 0 20px #ffd700;
    }

    /* 极简未来风按钮样式 */
    .tech-btn {
      position: relative;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #333;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: bold;
      letter-spacing: 1px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
      display: flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(8px);
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }

    /* 悬停时的背景动效 */
    .tech-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,0.6), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .tech-btn:hover::before {
      transform: translateX(100%);
    }

    .tech-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.8);
    }

    .tech-btn svg {
      transition: transform 0.3s ease;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
    }
    
    .tech-btn:hover svg {
        transform: scale(1.1);
    }

    /* 绿色变体 (重来) */
    .tech-btn.green {
      color: #2e7d32;
      border-color: rgba(76, 175, 80, 0.3);
      background: linear-gradient(135deg, rgba(232, 245, 233, 0.6), rgba(200, 230, 201, 0.4));
    }
    .tech-btn.green:hover {
      background: linear-gradient(135deg, rgba(232, 245, 233, 0.9), rgba(165, 214, 167, 0.8));
      border-color: #4caf50;
      color: #1b5e20;
    }

    /* 红色变体 (退出) */
    .tech-btn.red {
      color: #c62828;
      border-color: rgba(244, 67, 54, 0.3);
      background: linear-gradient(135deg, rgba(255, 235, 238, 0.6), rgba(255, 205, 210, 0.4));
    }
    .tech-btn.red:hover {
      background: linear-gradient(135deg, rgba(255, 235, 238, 0.9), rgba(239, 154, 154, 0.8));
      border-color: #f44336;
      color: #b71c1c;
    }

    .dashboard-divider {
        width: 2px;
        height: 80px;
        background: rgba(0,0,0,0.1);
        margin: 0 10px;
    }

    .meter {
      position: relative;
      width: 100px;
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* 计时器样式 */
    .timer-meter {
        width: 140px; /* 稍微大一点 */
        height: 140px;
        background: radial-gradient(circle, #fff 40%, #f0f0f5 100%);
        border-radius: 50%;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.1);
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 4px solid #fff;
    }
    
    .timer-val {
        font-family: 'Courier New', monospace;
        font-size: 28px;
        font-weight: bold;
        color: #333;
        z-index: 2;
    }
    
    .timer-label {
        font-size: 12px;
        color: #888;
        margin-top: 5px;
    }
    
    .timer-meter.small {
        width: 80px;
        height: 80px;
        border: 2px solid #fff;
    }
    
    .timer-meter.small .timer-ring {
        width: 80px;
        height: 80px;
        top: -2px;
        left: -2px;
        border-width: 2px;
    }
    
    .timer-meter.small .timer-val {
        font-size: 16px;
    }
    
    .timer-meter.small .timer-label {
        font-size: 10px;
    }
    
    /* 旋转的光圈 */
    .timer-ring {
        position: absolute;
        top: -4px;
        left: -4px;
        width: 140px;
        height: 140px;
        border-radius: 50%;
        border: 4px solid transparent;
        border-top-color: #ff9a9e;
        border-right-color: #fad0c4;
        animation: spin 2s linear infinite;
        z-index: 1;
        pointer-events: none;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .meter.small {
        width: 80px;
        height: 80px;
    }
    
    .meter.small svg {
        width: 80px;
        height: 80px;
    }

    .meter.small circle {
        width: 80px;
        height: 80px;
        r: 32;
        cx: 40;
        cy: 40;
        stroke-width: 6;
    }
    
    .meter.small .fg {
        stroke-dasharray: 201.06; /* 2 * PI * 32 */
        stroke-dashoffset: 201.06;
    }

    .meter.small .value {
        font-size: 18px;
    }
    
    .meter.small .label {
        font-size: 10px;
    }

    .meter svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100px;
      transform: rotate(-90deg);
    }

    .meter circle {
      width: 100px;
      height: 100px;
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      cx: 50;
      cy: 50;
      r: 40;
    }

    .meter .bg {
      stroke: #eee;
    }

    .meter .fg {
      stroke: #ff9a9e;
      stroke-dasharray: 251.32; /* 2 * PI * 40 */
      stroke-dashoffset: 251.32;
      transition: stroke-dashoffset 0.5s ease;
    }

    .meter .value {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      z-index: 1;
    }

    .meter .label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      z-index: 1;
    }

    /* 练习区域 */
    .practice-area {
      background: white;
      padding: 20px 30px; /* 30px -> 20px */
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 20px; /* 30px -> 20px */
      width: 100%;
      max-width: 1200px; /* 960 -> 1200 */
      text-align: center;
      position: relative;
    }

    .source-tag {
      position: absolute;
      top: -15px;
      left: 20px;
      background: #ff9a9e;
      color: white;
      padding: 5px 15px;
      border-radius: 15px;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(255, 154, 158, 0.3);
    }

    .text-display {
      margin-bottom: 10px; /* 20px -> 10px */
      line-height: 1.2;
      font-family: "KaiTi", "楷体", serif;
      min-height: 80px; /* 100px -> 80px */
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      align-items: flex-end; /* 底部对齐 */
    }

    .char-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      margin: 0 2px;
      transition: all 0.2s;
    }

    .char-box .pinyin {
      font-size: 14px;
      color: #888;
      font-family: Arial, sans-serif;
      margin-bottom: 4px;
      opacity: 0.6;
      transition: opacity 0.2s, color 0.2s;
    }
    
    .char-box .char {
      font-size: 32px;
      padding: 0 2px;
      border-bottom: 3px solid transparent; /* 预留边框位置 */
      transition: color 0.2s, border-color 0.2s;
    }

    /* 状态样式 */
    .char-box.correct .char {
      color: #4caf50;
    }
    .char-box.correct .pinyin {
      color: #4caf50;
      opacity: 0.8;
    }

    .char-box.wrong .char {
      color: #f44336;
      text-decoration: underline wavy #f44336;
    }
    .char-box.wrong .pinyin {
      color: #f44336;
      opacity: 1;
    }

    .char-box.current .char {
      background: rgba(255, 235, 59, 0.3);
      border-bottom-color: #ffeb3b;
    }
    .char-box.current .pinyin {
      color: #ff9800;
      opacity: 1;
      font-weight: bold;
      transform: scale(1.1);
    }

    .input-wrapper {
      position: relative;
    }

    input[type="text"] {
      width: 100%;
      padding: 15px;
      font-size: 20px;
      border: 2px solid #eee;
      border-radius: 10px;
      outline: none;
      transition: all 0.3s;
      text-align: center;
      font-family: inherit;
    }

    input[type="text"]:focus {
      border-color: #ff9a9e;
      box-shadow: 0 0 0 4px rgba(255, 154, 158, 0.1);
    }

    input[type="text"].error {
      border-color: #f44336;
      background: #ffebee;
      animation: shake 0.4s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* 键盘区域 */
    .keyboard-wrapper {
      position: relative;
      background: #f0f0f5; /* 恢复浅色背景 */
      padding: 20px;
      border-radius: 20px;
      width: 100%;
      max-width: 1200px; /* 960 -> 1200 */
      /* 恢复拟态风格阴影 */
      box-shadow: 
        20px 20px 60px #d9d9e0, 
        -20px -20px 60px #ffffff;
      z-index: 1; /* 确保在火焰之上(如果需要) */
    }

    #keyboard-fire {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999; /* 确保最顶层 */
    }
    
    /* 调整键盘层级，让火焰能盖在键盘边缘上，但按键需要能点击 */
    .keyboard {
        position: relative;
        z-index: 100; /* 按键最高 */
    }

    .keyboard {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .row {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .key {
      flex: 1; /* 让按键自动填充宽度 */
      height: 60px; /* 稍微增加高度 */
      border-radius: 8px;
      background: linear-gradient(to bottom, #f9f9f9, #e6e6e6);
      box-shadow: 
        0 4px 0 #bbb,
        0 5px 10px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #555;
      cursor: pointer;
      transition: all 0.05s;
      position: relative;
      user-select: none;
      margin-bottom: 5px; /* 补偿3D高度 */
      border: 1px solid #ddd;
      font-size: 18px; /* 字体稍微大一点 */
    }

    .key.tab { flex: 1.5; }
    .key.caps { flex: 1.8; }
    .key.shift { flex: 2.2; }
    .key.enter { flex: 2.2; }
    .key.ctrl { flex: 1.5; }
    .key.space { flex: 8; } /* 增加空格宽度 */
    
    /* 保持某些键的基本比例 */
    .row {
        display: flex;
        justify-content: center;
        gap: 10px;
        width: 100%; /* 占满容器 */
    }

    .key:active, .key.active {
      transform: translateY(4px);
      box-shadow: 
        0 0 0 #bbb,
        inset 0 2px 5px rgba(0,0,0,0.1);
      background: #e6e6e6;
      color: #ff9a9e;
      border-color: #ccc;
    }

    /* 提示 Toast */
    .toast {
      position: fixed;
      top: 20%; /* 改为靠上显示，避免遮挡练习区 */
      left: 50%;
      transform: translateX(-50%) scale(0.8);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 40px;
      border-radius: 50px;
      font-size: 24px;
      font-weight: bold;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
      text-align: center;
      max-width: 80%;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }

    .toast.success {
      background: linear-gradient(135deg, rgba(255, 235, 59, 0.95), rgba(255, 193, 7, 0.9));
      color: #5d4037; /* 深褐色文字，在黄色背景上更清晰 */
      box-shadow: 
        0 10px 30px rgba(255, 193, 7, 0.4),
        inset 0 0 20px rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.4);
      transform: translateX(-50%) scale(1.1); /* 稍微放大一点 */
    }
    /* 开始界面 */
    .start-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 20000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
      transition: opacity 0.5s;
    }
    
    .start-overlay.hide {
        opacity: 0;
        pointer-events: none;
    }
    
    .start-card {
        background: linear-gradient(135deg, #fff, #f0f0f5);
        padding: 40px 60px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        border: 2px solid #fff;
        animation: float-card 3s ease-in-out infinite;
    }
    
    @keyframes float-card {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
    
    .start-card h1 {
        font-size: 48px;
        margin-bottom: 20px;
        background: linear-gradient(to right, #ff5722, #c33a7a);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 900;
    }
    
    .start-card p {
        font-size: 18px;
        color: #666;
        line-height: 1.6;
        margin-bottom: 30px;
    }
    
    #start-btn {
        padding: 15px 40px;
        font-size: 24px;
        border: none;
        border-radius: 50px;
        background: linear-gradient(90deg, #ff9a9e, #fad0c4);
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 10px 20px rgba(255, 154, 158, 0.4);
    }
    
    #start-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 15px 30px rgba(255, 154, 158, 0.6);
    }

    /* 胜利结算画面 */
    .victory-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease;
      backdrop-filter: blur(10px);
    }

    .victory-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .victory-title {
      font-family: "Microsoft YaHei", sans-serif;
      font-size: 80px;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 
        0 0 20px #ff5722,
        0 0 40px #ff5722,
        0 0 60px #ff5722;
      margin-bottom: 50px;
      transform: scale(0.1);
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .victory-overlay.show .victory-title {
      transform: scale(1);
      opacity: 1;
    }

    .restart-btn {
      width: auto;
      height: auto;
      padding: 10px 25px;
      border-radius: 50px;
      border: 3px solid #fff;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
      transform: translateY(30px) scale(0.8);
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.5s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      outline: none;
    }

    .restart-btn svg {
      width: 20px;
      height: 20px;
      stroke: #fff;
      stroke-width: 3;
      transition: transform 0.5s ease;
    }

    .restart-btn:hover {
      background: linear-gradient(135deg, #ff8087, #f6b0a0);
      box-shadow: 0 15px 40px rgba(255, 154, 158, 0.8);
      transform: translateY(0) scale(1.1);
    }
    
    .restart-btn:hover svg {
      transform: rotate(-180deg); /* 逆时针旋转图标 */
    }

    .victory-overlay.show .restart-btn {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    /* 元素炸裂动画 */
    .explode-out {
      animation: explode-vanish 1s forwards;
    }

    @keyframes explode-vanish {
      0% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
        filter: blur(0);
      }
      50% {
        transform: scale(1.1) rotate(5deg);
        opacity: 0.8;
        filter: blur(2px);
      }
      100% {
        transform: scale(2) rotate(20deg);
        opacity: 0;
        filter: blur(20px);
      }
    }
  </style>
</head>
<body>

  <!-- Logo 与 Combo 区域 -->
  <div class="header-area">
    <!-- Logo -->
    <div class="app-logo">
      <svg width="240" height="80" viewBox="0 0 240 80" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="heroGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#c33a7a;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#ff9a9e;stop-opacity:1" />
          </linearGradient>
          <filter id="glow">
            <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        
        <!-- 键盘底座图形 -->
        <rect x="20" y="45" width="200" height="25" rx="5" fill="#f0f0f5" stroke="#c33a7a" stroke-width="2"/>
        <!-- 装饰按键 -->
        <rect x="30" y="50" width="15" height="15" rx="2" fill="#ffd6f2"/>
        <rect x="50" y="50" width="15" height="15" rx="2" fill="#ffd6f2"/>
        <rect x="70" y="50" width="15" height="15" rx="2" fill="#ffd6f2"/>
        
        <!-- 文字 -->
        <text x="120" y="55" font-family="'Microsoft YaHei', sans-serif" font-size="42" font-weight="900" fill="url(#heroGradient)" text-anchor="middle" filter="url(#glow)" style="text-shadow: 2px 2px 0px white;">
          打字英雄
        </text>
        
        <!-- 闪光星星 -->
        <path d="M210 20 L213 28 L221 28 L215 34 L217 42 L210 37 L203 42 L205 34 L199 28 L207 28 Z" fill="#ffeb3b" stroke="#fbc02d" stroke-width="1">
          <animateTransform attributeName="transform" type="rotate" from="0 210 32" to="360 210 32" dur="3s" repeatCount="indefinite"/>
        </path>
      </svg>
    </div>

    <!-- 游戏控制按钮 (右上角) -->
    <div class="game-controls" style="
      position: absolute;
      top: 30px;
      right: 0;
      display: flex; 
      gap: 15px; 
      align-items: center;
      z-index: 200;
    ">
      <button class="tech-btn green" id="btn-restart-game" title="重新开始本局">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
        </svg>
        重来
      </button>
      <button class="tech-btn red" id="btn-quit-game" title="退出游戏">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
          <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>
        </svg>
        退出
      </button>
    </div>

    <!-- 连击特效 (移至此处) -->
    <div class="combo-container" id="combo-container">
      <div class="combo-fire"></div>
      <div class="combo-count" id="combo-count">0</div>
      <div class="combo-label">Combo!</div>
    </div>
  </div>

  <!-- 音频控制 (已隐藏) -->
  <div class="audio-controls" style="display: none;">
    <button class="icon-btn" id="btn-bgm" title="背景音乐开关">🎵</button>
    <button class="icon-btn" id="btn-sfx" title="音效开关">🔊</button>
  </div>

  <!-- 仪表盘 -->
  <div class="dashboard">
    <!-- 当前条目耗时 (新增) -->
    <div class="timer-meter">
        <div class="timer-ring" id="current-timer-ring"></div>
        <div class="timer-val" id="current-timer-val">0.0s</div>
        <div class="timer-label">当前耗时</div>
    </div>

    <div class="dashboard-divider"></div>

    <!-- 速度 -->
    <div class="meter">
      <svg>
        <circle class="bg" />
        <circle class="fg" id="wpm-circle" />
      </svg>
      <div class="value" id="wpm">0</div>
      <div class="label">字/分</div>
    </div>
    
    <!-- 准确率 -->
    <div class="meter">
      <svg>
        <circle class="bg" />
        <circle class="fg" id="accuracy-circle" style="stroke: #4caf50;" />
      </svg>
      <div class="value" id="accuracy">100%</div>
      <div class="label">准确率</div>
    </div>

    <!-- 进度 -->
    <div class="meter">
      <svg>
        <circle class="bg" />
        <circle class="fg" id="progress-circle" style="stroke: #2196f3;" />
      </svg>
      <div class="value" id="progress-text">0/0</div>
      <div class="label">进度</div>
    </div>
    
    <div class="dashboard-divider"></div>
    
    <!-- 总用时 (移到右侧，变小) -->
    <div class="timer-meter small">
        <div class="timer-ring"></div>
        <div class="timer-val" id="timer-val">00:00</div>
        <div class="timer-label">总用时</div>
    </div>

    <!-- 平均速度 -->
    <div class="meter small">
      <svg>
        <circle class="bg" />
        <circle class="fg" id="avg-wpm-circle" style="stroke: #9c27b0;" />
      </svg>
      <div class="value" id="avg-wpm">0</div>
      <div class="label">平均速度</div>
    </div>
    
    <!-- 平均准确率 -->
    <div class="meter small">
      <svg>
        <circle class="bg" />
        <circle class="fg" id="avg-accuracy-circle" style="stroke: #ff5722;" />
      </svg>
      <div class="value" id="avg-accuracy">100%</div>
      <div class="label">平均准确</div>
    </div>
  </div>

  <!-- Combo 进度条 (新增) -->
  <div class="combo-progress-area" id="combo-progress-area">
      <div class="combo-track">
          <!-- 进度条 -->
          <div class="combo-bar" id="combo-bar">
              <!-- 火箭 -->
              <div class="combo-rocket">🚀</div>
          </div>
          <!-- 里程碑标记 -->
          <!-- 0: 起点 (不显示) -->
          
          <!-- 100: 中点 -->
          <div class="combo-milestone" id="milestone-100" style="left: 50%;">
              <div class="milestone-text">100</div>
              <div class="milestone-marker"></div>
          </div>
          
          <!-- 200: 终点 -->
          <div class="combo-milestone trophy" id="milestone-200" style="left: 100%;">
              <div class="milestone-text">200</div>
              <div class="milestone-marker">🏆</div>
          </div>
      </div>
  </div>

  <!-- 练习区域 -->
  <div class="practice-area">
    <div class="source-tag" id="source-tag">来源：小学语文</div>
    <div class="text-display" id="text-display">
      <!-- 动态生成文字 -->
    </div>
    <div class="input-wrapper">
      <input type="text" id="input-field" placeholder="点击这里开始打字..." autocomplete="off">
    </div>
  </div>

  <!-- 键盘区域 -->
  <div class="keyboard-wrapper">
    <div class="keyboard">
      <!-- 原 combo 移走 -->

      <div class="row">
        <div class="key tab" data-key="tab"><span class="key-label">Tab</span></div>
        <div class="key" data-key="q"><span class="key-label">Q</span></div>
        <div class="key" data-key="w"><span class="key-label">W</span></div>
        <div class="key" data-key="e"><span class="key-label">E</span></div>
        <div class="key" data-key="r"><span class="key-label">R</span></div>
        <div class="key" data-key="t"><span class="key-label">T</span></div>
        <div class="key" data-key="y"><span class="key-label">Y</span></div>
        <div class="key" data-key="u"><span class="key-label">U</span></div>
        <div class="key" data-key="i"><span class="key-label">I</span></div>
        <div class="key" data-key="o"><span class="key-label">O</span></div>
        <div class="key" data-key="p"><span class="key-label">P</span></div>
        <div class="key tab" data-key="backspace" style="opacity: 0.5"><span class="key-label">←</span></div>
      </div>
      <div class="row">
        <div class="key caps" data-key="capslock"><span class="key-label">Caps</span></div>
        <div class="key" data-key="a"><span class="key-label">A</span></div>
        <div class="key" data-key="s"><span class="key-label">S</span></div>
        <div class="key" data-key="d"><span class="key-label">D</span></div>
        <div class="key" data-key="f"><span class="key-label">F</span></div>
        <div class="key" data-key="g"><span class="key-label">G</span></div>
        <div class="key" data-key="h"><span class="key-label">H</span></div>
        <div class="key" data-key="j"><span class="key-label">J</span></div>
        <div class="key" data-key="k"><span class="key-label">K</span></div>
        <div class="key" data-key="l"><span class="key-label">L</span></div>
        <div class="key enter" data-key="enter"><span class="key-label">Enter</span></div>
      </div>
      <div class="row">
        <div class="key shift" data-key="shift"><span class="key-label">Shift</span></div>
        <div class="key" data-key="z"><span class="key-label">Z</span></div>
        <div class="key" data-key="x"><span class="key-label">X</span></div>
        <div class="key" data-key="c"><span class="key-label">C</span></div>
        <div class="key" data-key="v"><span class="key-label">V</span></div>
        <div class="key" data-key="b"><span class="key-label">B</span></div>
        <div class="key" data-key="n"><span class="key-label">N</span></div>
        <div class="key" data-key="m"><span class="key-label">M</span></div>
        <div class="key shift" data-key="shift-right"><span class="key-label">Shift</span></div>
      </div>
      <div class="row">
        <div class="key ctrl" data-key="ctrl"><span class="key-label">Ctrl</span></div>
        <div class="key ctrl" data-key="alt"><span class="key-label">Alt</span></div>
        <div class="key space" data-key=" "><span class="key-label">Space</span></div>
        <div class="key ctrl" data-key="alt-right"><span class="key-label">Alt</span></div>
        <div class="key ctrl" data-key="ctrl-right"><span class="key-label">Ctrl</span></div>
      </div>
    </div>
  </div>

  <div class="start-overlay" id="start-overlay">
    <div class="start-card">
        <h1>打字英雄</h1>
        <p>准备好开始这场热血的指尖冒险了吗？<br>击败每一个汉字，成为真正的键盘侠！</p>
        <button id="start-btn">按 Enter 键开始冒险</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>
  <canvas id="fireworks"></canvas>
  <canvas id="keyboard-fire"></canvas>

  <div class="victory-overlay" id="victory-overlay">
    <div class="victory-title">恭喜你<br>成为了打字英雄！</div>
    <button class="restart-btn" id="restart-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
            <path d="M3 3v5h5" />
        </svg>
        重新开始
    </button>
    <div style="margin-top: 20px; color: rgba(255,255,255,0.8); font-size: 16px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">按 Enter 键重新开始</div>
  </div>

  <!-- 引入拼音库 -->
  <script src="https://unpkg.com/pinyin-pro"></script>

  <script>
    // --- 2. 语音文案与文件映射库 ---
    // 为了实现文案和音频的精准匹配，我们需要建立一个映射表
    // 格式：{ text: "文案内容", file: "文件名(不带后缀)" }
    // 注意：变量名加了 V2 后缀以避免重复声明错误
    
    const mockeryLibV2 = [
        // level10 (mock_error_0 ~ mock_error_9)
        { t: "才10秒？这就开始思考人生了？", f: "mock_error_0" },
        { t: "键盘：我感觉到了你的犹豫。", f: "mock_error_1" },
        { t: "是不是突然忘了拼音怎么打？", f: "mock_error_2" },
        { t: "发呆是解决不了问题的，敲键盘可以。", f: "mock_error_3" },
        { t: "你的手指是在做伸展运动吗？", f: "mock_error_4" },
        { t: "这速度，乌龟看了都直摇头。", f: "mock_error_5" },
        { t: "嘿，醒醒，还没到午休时间。", f: "mock_error_6" },
        { t: "你在等键盘自己打字吗？", f: "mock_error_7" },
        { t: "这个字很难吗？小学生都会哦。", f: "mock_error_8" },
        { t: "别停啊，连击都要断了！", f: "mock_error_9" },
        
        // level20 (mock_error_10 ~ mock_error_19)
        { t: "20秒了，你是在给键盘做足底按摩吗？", f: "mock_error_10" },
        { t: "我奶奶打字都比你快，真的。", f: "mock_error_11" },
        { t: "你是在用意念打字吗？", f: "mock_error_12" },
        { t: "键盘都快睡着了，你听见它的呼噜声了吗？", f: "mock_error_13" },
        { t: "这种速度，网线都要被你急断了。", f: "mock_error_14" },
        { t: "是不是需要我帮你百度一下拼音？", f: "mock_error_15" },
        { t: "你是在绣花吗？这么慢。", f: "mock_error_16" },
        { t: "再不敲，键盘上的灰都要积起来了。", f: "mock_error_17" },
        { t: "你的手速是被封印了吗？", f: "mock_error_18" },
        { t: "加油啊，蜗牛都在超车道等你了。", f: "mock_error_19" },
        
        // level30 (mock_error_20 ~ mock_error_29)
        { t: "30秒！你是在等灵感从天而降吗？", f: "mock_error_20" },
        { t: "这手速，去抢红包肯定抢不到。", f: "mock_error_21" },
        { t: "别发呆了，时间可是很贵的。", f: "mock_error_22" },
        { t: "你是在和键盘比谁更冷静吗？", f: "mock_error_23" },
        { t: "看来你需要一杯咖啡提提神。", f: "mock_error_24" },
        { t: "这种效率，老板看了都要流泪。", f: "mock_error_25" },
        { t: "是不是被这个字的美貌惊呆了？", f: "mock_error_26" },
        { t: "键盘：求求你，敲我一下吧。", f: "mock_error_27" },
        { t: "你的手指是不是粘在键盘上了？", f: "mock_error_28" },
        { t: "再不打完，天都要黑了。", f: "mock_error_29" },
        
        // level60 (mock_error_30 ~ mock_error_35)
        { t: "一分钟了！你是想把键盘坐穿吗？", f: "mock_error_30" },
        { t: "这局游戏要变成持久战了吗？", f: "mock_error_31" },
        { t: "我已经开始怀疑人生了，你呢？", f: "mock_error_32" },
        { t: "键盘都要长草了，真的。", f: "mock_error_33" },
        { t: "你是在考验我的耐心吗？", f: "mock_error_34" },
        { t: "放弃吧，或者爆发吧！", f: "mock_error_35" }
    ];

    // 鼓励文案 (praise_0 ~ praise_33)
    const praiseLibV2 = [
        { t: "太棒了！这手速简直逆天！", f: "praise_0" },
        { t: "完美！键盘都在为你欢呼！", f: "praise_1" },
        { t: "不可思议！你是触手怪转世吗？", f: "praise_2" },
        { t: "这节奏，简直就是艺术！", f: "praise_3" },
        { t: "干得漂亮！继续保持！", f: "praise_4" },
        { t: "你是电，你是光，你是键盘的神话！", f: "praise_5" },
        { t: "这速度，我眼睛都快跟不上了！", f: "praise_6" },
        { t: "太强了！请收下我的膝盖！", f: "praise_7" },
        { t: "行云流水，一气呵成！", f: "praise_8" },
        { t: "这就是传说中的无影手吗？", f: "praise_9" },
        { t: "稳准狠！职业选手的水平！", f: "praise_10" },
        { t: "键盘侠中的战斗机！", f: "praise_11" },
        { t: "你的指尖在跳舞！", f: "praise_12" },
        { t: "这不仅是打字，这是享受！", f: "praise_13" },
        { t: "太快了，小心键盘起火！", f: "praise_14" },
        { t: "精准打击，例无虚发！", f: "praise_15" },
        { t: "你是怎么做到的？教教我！", f: "praise_16" },
        { t: "这手速，单身多少年练出来的？", f: "praise_17" },
        { t: "简直就是打字机器！", f: "praise_18" },
        { t: "太丝滑了，像吃了德芙一样！", f: "praise_19" },
        { t: "你的手指是装了马达吗？", f: "praise_20" },
        { t: "这波操作我给满分！", f: "praise_21" },
        { t: "秀得我头皮发麻！", f: "praise_22" },
        { t: "你是吃键盘长大的吗？", f: "praise_23" },
        { t: "这反应速度，绝了！", f: "praise_24" },
        { t: "键盘之神附体了！", f: "praise_25" },
        { t: "太疯狂了，根本停不下来！", f: "praise_26" },
        { t: "你的手速已经超越了人类极限！", f: "praise_27" },
        { t: "这才是真正的速度与激情！", f: "praise_28" },
        { t: "我都看呆了，太厉害了！", f: "praise_29" },
        { t: "这手速，不去弹钢琴可惜了！", f: "praise_30" },
        { t: "无敌是多么寂寞！", f: "praise_31" },
        { t: "你的键盘在燃烧！", f: "praise_32" },
        { t: "这就是传说中的人键合一！", f: "praise_33" }
    ];

    // 游戏结束嘲讽 (gameover_0 ~ gameover_19)
    const gameOverMockeryV2 = [
        { t: "游戏结束！这成绩，我都替你脸红。", f: "gameover_0" },
        { t: "完了？就这？我还以为你能多坚持一会儿。", f: "gameover_1" },
        { t: "虽然失败了，但你成功地浪费了一分钟。", f: "gameover_2" },
        { t: "这水平，建议回炉重造。", f: "gameover_3" },
        { t: "键盘：我尽力了，是你的手不行。", f: "gameover_4" },
        { t: "别灰心，虽然你菜，但是你心态好啊。", f: "gameover_5" },
        { t: "这手速，告别电竞圈吧。", f: "gameover_6" },
        { t: "看来你需要换个更贵的键盘，或者换双手。", f: "gameover_7" },
        { t: "游戏结束，你的自信心还在吗？", f: "gameover_8" },
        { t: "这操作，真是下饭。", f: "gameover_9" },
        { t: "我都看困了，终于结束了。", f: "gameover_10" },
        { t: "是不是键盘上有胶水？", f: "gameover_11" },
        { t: "没事，下次记得把手带上。", f: "gameover_12" },
        { t: "这成绩，只能说重在参与。", f: "gameover_13" },
        { t: "你是在用脚打字吗？", f: "gameover_14" },
        { t: "别气馁，至少你比树懒快一点点。", f: "gameover_15" },
        { t: "游戏结束，请接受现实的毒打。", f: "gameover_16" },
        { t: "这水平，连我奶奶都看不下去了。", f: "gameover_17" },
        { t: "承认吧，你可能不适合这个游戏。", f: "gameover_18" },
        { t: "失败是成功之母，但你这母亲有点多。", f: "gameover_19" }
    ];

    // --- 1. 素材库 (带出处) ---
    // 格式：{ text: "...", source: "..." }
    const rawTextLib = [
      // 唐诗
      { t: "君不见黄河之水天上来，奔流到海不复回。", s: "李白《将进酒》" },
      { t: "君不见高堂明镜悲白发，朝如青丝暮成雪。", s: "李白《将进酒》" },
      { t: "人生得意须尽欢，莫使金樽空对月。", s: "李白《将进酒》" },
      { t: "天生我材必有用，千金散尽还复来。", s: "李白《将进酒》" },
      { t: "长风破浪会有时，直挂云帆济沧海。", s: "李白《行路难》" },
      { t: "大鹏一日同风起，扶摇直上九万里。", s: "李白《上李邕》" },
      { t: "安能摧眉折腰事权贵，使我不得开心颜。", s: "李白《梦游天姥吟留别》" },
      { t: "两岸猿声啼不住，轻舟已过万重山。", s: "李白《早发白帝城》" },
      { t: "孤帆远影碧空尽，唯见长江天际流。", s: "李白《黄鹤楼送孟浩然之广陵》" },
      { t: "露从今夜白，月是故乡明。", s: "杜甫《月夜忆舍弟》" },
      { t: "会当凌绝顶，一览众山小。", s: "杜甫《望岳》" },
      { t: "国破山河在，城春草木深。", s: "杜甫《春望》" },
      { t: "感时花溅泪，恨别鸟惊心。", s: "杜甫《春望》" },
      { t: "烽火连三月，家书抵万金。", s: "杜甫《春望》" },
      { t: "无边落木萧萧下，不尽长江滚滚来。", s: "杜甫《登高》" },
      { t: "随风潜入夜，润物细无声。", s: "杜甫《春夜喜雨》" },
      { t: "海内存知己，天涯若比邻。", s: "王勃《送杜少府之任蜀州》" },
      { t: "落霞与孤鹜齐飞，秋水共长天一色。", s: "王勃《滕王阁序》" },
      { t: "空山新雨后，天气晚来秋。", s: "王维《山居秋暝》" },
      { t: "明月松间照，清泉石上流。", s: "王维《山居秋暝》" },
      { t: "大漠孤烟直，长河落日圆。", s: "王维《使至塞上》" },
      { t: "同是天涯沦落人，相逢何必曾相识。", s: "白居易《琵琶行》" },
      { t: "在天愿作比翼鸟，在地愿为连理枝。", s: "白居易《长恨歌》" },
      { t: "天长地久有时尽，此恨绵绵无绝期。", s: "白居易《长恨歌》" },
      { t: "野火烧不尽，春风吹又生。", s: "白居易《赋得古原草送别》" },
      { t: "曾经沧海难为水，除却巫山不是云。", s: "元稹《离思》" },
      { t: "人面不知何处去，桃花依旧笑春风。", s: "崔护《题都城南庄》" },
      { t: "商女不知亡国恨，隔江犹唱后庭花。", s: "杜牧《泊秦淮》" },
      { t: "东边日出西边雨，道是无晴却有晴。", s: "刘禹锡《竹枝词》" },
      { t: "沉舟侧畔千帆过，病树前头万木春。", s: "刘禹锡《酬乐天扬州初逢席上见赠》" },
      { t: "旧时王谢堂前燕，飞入寻常百姓家。", s: "刘禹锡《乌衣巷》" },
      { t: "春蚕到死丝方尽，蜡炬成灰泪始干。", s: "李商隐《无题》" },
      { t: "身无彩凤双飞翼，心有灵犀一点通。", s: "李商隐《无题》" },
      { t: "此情可待成追忆，只是当时已惘然。", s: "李商隐《锦瑟》" },

      // 宋词
      { t: "明月几时有？把酒问青天。", s: "苏轼《水调歌头》" },
      { t: "但愿人长久，千里共婵娟。", s: "苏轼《水调歌头》" },
      { t: "大江东去，浪淘尽，千古风流人物。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "乱石穿空，惊涛拍岸，卷起千堆雪。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "江山如画，一时多少豪杰。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "十年生死两茫茫，不思量，自难忘。", s: "苏轼《江城子》" },
      { t: "老夫聊发少年狂，左牵黄，右擎苍。", s: "苏轼《江城子·密州出猎》" },
      { t: "会挽雕弓如满月，西北望，射天狼。", s: "苏轼《江城子·密州出猎》" },
      { t: "莫听穿林打叶声，何妨吟啸且徐行。", s: "苏轼《定风波》" },
      { t: "竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。", s: "苏轼《定风波》" },
      { t: "回首向来萧瑟处，归去，也无风雨也无晴。", s: "苏轼《定风波》" },
      { t: "众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。", s: "辛弃疾《青玉案·元夕》" },
      { t: "醉里挑灯看剑，梦回吹角连营。", s: "辛弃疾《破阵子》" },
      { t: "了却君王天下事，赢得生前身后名。", s: "辛弃疾《破阵子》" },
      { t: "想当年，金戈铁马，气吞万里如虎。", s: "辛弃疾《永遇乐·京口北固亭怀古》" },
      { t: "三十功名尘与土，八千里路云和月。", s: "岳飞《满江红》" },
      { t: "莫等闲，白了少年头，空悲切。", s: "岳飞《满江红》" },
      { t: "寻寻觅觅，冷冷清清，凄凄惨惨戚戚。", s: "李清照《声声慢》" },
      { t: "生当作人杰，死亦为鬼雄。", s: "李清照《夏日绝句》" },
      { t: "花自飘零水自流，一种相思，两处闲愁。", s: "李清照《一剪梅》" },
      { t: "此情无计可消除，才下眉头，却上心头。", s: "李清照《一剪梅》" },
      { t: "知否，知否？应是绿肥红瘦。", s: "李清照《如梦令》" },
      { t: "衣带渐宽终不悔，为伊消得人憔悴。", s: "柳永《蝶恋花》" },
      { t: "多情自古伤离别，更那堪，冷落清秋节。", s: "柳永《雨霖铃》" },
      { t: "今宵酒醒何处？杨柳岸，晓风残月。", s: "柳永《雨霖铃》" },
      { t: "无可奈何花落去，似曾相识燕归来。", s: "晏殊《浣溪沙》" },
      { t: "昨夜西风凋碧树，独上高楼，望尽天涯路。", s: "晏殊《蝶恋花》" },
      { t: "两情若是久长时，又岂在朝朝暮暮。", s: "秦观《鹊桥仙》" },
      { t: "红酥手，黄縢酒，满城春色宫墙柳。", s: "陆游《钗头凤》" },
      { t: "山重水复疑无路，柳暗花明又一村。", s: "陆游《游山西村》" },
      { t: "小楼一夜听春雨，深巷明朝卖杏花。", s: "陆游《临安春雨初霁》" },

      // 毛主席诗词
      { t: "北国风光，千里冰封，万里雪飘。", s: "毛泽东《沁园春·雪》" },
      { t: "山舞银蛇，原驰蜡象，欲与天公试比高。", s: "毛泽东《沁园春·雪》" },
      { t: "须晴日，看红装素裹，分外妖娆。", s: "毛泽东《沁园春·雪》" },
      { t: "江山如此多娇，引无数英雄竞折腰。", s: "毛泽东《沁园春·雪》" },
      { t: "惜秦皇汉武，略输文采；唐宗宋祖，稍逊风骚。", s: "毛泽东《沁园春·雪》" },
      { t: "一代天骄，成吉思汗，只识弯弓射大雕。", s: "毛泽东《沁园春·雪》" },
      { t: "俱往矣，数风流人物，还看今朝。", s: "毛泽东《沁园春·雪》" },
      { t: "独立寒秋，湘江北去，橘子洲头。", s: "毛泽东《沁园春·长沙》" },
      { t: "看万山红遍，层林尽染；漫江碧透，百舸争流。", s: "毛泽东《沁园春·长沙》" },
      { t: "鹰击长空，鱼翔浅底，万类霜天竞自由。", s: "毛泽东《沁园春·长沙》" },
      { t: "怅寥廓，问苍茫大地，谁主沉浮？", s: "毛泽东《沁园春·长沙》" },
      { t: "恰同学少年，风华正茂；书生意气，挥斥方遒。", s: "毛泽东《沁园春·长沙》" },
      { t: "指点江山，激扬文字，粪土当年万户侯。", s: "毛泽东《沁园春·长沙》" },
      { t: "曾记否，到中流击水，浪遏飞舟？", s: "毛泽东《沁园春·长沙》" },
      { t: "红军不怕远征难，万水千山只等闲。", s: "毛泽东《七律·长征》" },
      { t: "五岭逶迤腾细浪，乌蒙磅礴走泥丸。", s: "毛泽东《七律·长征》" },
      { t: "金沙水拍云崖暖，大渡桥横铁索寒。", s: "毛泽东《七律·长征》" },
      { t: "更喜岷山千里雪，三军过后尽开颜。", s: "毛泽东《七律·长征》" },
      { t: "风雨送春归，飞雪迎春到。", s: "毛泽东《卜算子·咏梅》" },
      { t: "已是悬崖百丈冰，犹有花枝俏。", s: "毛泽东《卜算子·咏梅》" },
      { t: "俏也不争春，只把春来报。", s: "毛泽东《卜算子·咏梅》" },
      { t: "待到山花烂漫时，她在丛中笑。", s: "毛泽东《卜算子·咏梅》" },
      { t: "西风烈，长空雁叫霜晨月。", s: "毛泽东《忆秦娥·娄山关》" },
      { t: "霜晨月，马蹄声碎，喇叭声咽。", s: "毛泽东《忆秦娥·娄山关》" },
      { t: "雄关漫道真如铁，而今迈步从头越。", s: "毛泽东《忆秦娥·娄山关》" },
      { t: "从头越，苍山如海，残阳如血。", s: "毛泽东《忆秦娥·娄山关》" },
      { t: "天若有情天亦老，人间正道是沧桑。", s: "毛泽东《七律·人民解放军占领南京》" },
      { t: "宜将剩勇追穷寇，不可沽名学霸王。", s: "毛泽东《七律·人民解放军占领南京》" },
      { t: "才饮长沙水，又食武昌鱼。", s: "毛泽东《水调歌头·游泳》" },
      { t: "万里长江横渡，极目楚天舒。", s: "毛泽东《水调歌头·游泳》" },
      { t: "不管风吹浪打，胜似闲庭信步。", s: "毛泽东《水调歌头·游泳》" },
      { t: "一桥飞架南北，天堑变通途。", s: "毛泽东《水调歌头·游泳》" },
      { t: "神女应无恙，当惊世界殊。", s: "毛泽东《水调歌头·游泳》" },
      { t: "早已森严壁垒，更加众志成城。", s: "毛泽东《西江月·井冈山》" },
      { t: "敌军围困万千重，我自岿然不动。", s: "毛泽东《西江月·井冈山》" },
      { t: "中华儿女多奇志，不爱红装爱武装。", s: "毛泽东《七绝·为女民兵题照》" },
      { t: "不到长城非好汉，屈指行程二万。", s: "毛泽东《清平乐·六盘山》" },
      { t: "今日长缨在手，何时缚住苍龙？", s: "毛泽东《清平乐·六盘山》" },
      { t: "东方欲晓，莫道君行早。", s: "毛泽东《清平乐·会昌》" },
      { t: "踏遍青山人未老，风景这边独好。", s: "毛泽东《清平乐·会昌》" },
      { t: "世上无难事，只要肯登攀。", s: "毛泽东《水调歌头·重上井冈山》" },

      // 新增50篇经典古诗词与名句
      { t: "关关雎鸠，在河之洲。", s: "《诗经·周南·关雎》" },
      { t: "窈窕淑女，君子好逑。", s: "《诗经·周南·关雎》" },
      { t: "昔我往矣，杨柳依依。", s: "《诗经·小雅·采薇》" },
      { t: "今我来思，雨雪霏霏。", s: "《诗经·小雅·采薇》" },
      { t: "青青子衿，悠悠我心。", s: "《诗经·郑风·子衿》" },
      { t: "路漫漫其修远兮，吾将上下而求索。", s: "屈原《离骚》" },
      { t: "亦余心之所善兮，虽九死其犹未悔。", s: "屈原《离骚》" },
      { t: "风萧萧兮易水寒，壮士一去兮不复还。", s: "《战国策·荆轲刺秦王》" },
      { t: "对酒当歌，人生几何？", s: "曹操《短歌行》" },
      { t: "譬如朝露，去日苦多。", s: "曹操《短歌行》" },
      { t: "老骥伏枥，志在千里。", s: "曹操《龟蒙寿》" },
      { t: "烈士暮年，壮心不已。", s: "曹操《龟蒙寿》" },
      { t: "采菊东篱下，悠然见南山。", s: "陶渊明《饮酒·其五》" },
      { t: "奇文共欣赏，疑义相与析。", s: "陶渊明《移居》" },
      { t: "池塘生春草，园柳变鸣禽。", s: "谢灵运《登池上楼》" },
      { t: "海上生明月，天涯共此时。", s: "张九龄《望月怀远》" },
      { t: "前不见古人，后不见来者。", s: "陈子昂《登幽州台歌》" },
      { t: "念天地之悠悠，独怆然而涕下。", s: "陈子昂《登幽州台歌》" },
      { t: "不知细叶谁裁出，二月春风似剪刀。", s: "贺知章《咏柳》" },
      { t: "飞流直下三千尺，疑是银河落九天。", s: "李白《望庐山瀑布》" },
      { t: "举杯邀明月，对影成三人。", s: "李白《月下独酌》" },
      { t: "抽刀断水水更流，举杯消愁愁更愁。", s: "李白《宣州谢朓楼饯别校书叔云》" },
      { t: "仰天大笑出门去，我辈岂是蓬蒿人。", s: "李白《南陵别儿童入京》" },
      { t: "清水出芙蓉，天然去雕饰。", s: "李白《经乱离后天恩流夜郎忆旧游书怀》" },
      { t: "正是江南好风景，落花时节又逢君。", s: "杜甫《江南逢李龟年》" },
      { t: "为人性僻耽佳句，语不惊人死不休。", s: "杜甫《江上值水如海势聊短述》" },
      { t: "朱门酒肉臭，路有冻死骨。", s: "杜甫《自京赴奉先县咏怀五百字》" },
      { t: "尔曹身与名俱灭，不废江河万古流。", s: "杜甫《戏为六绝句》" },
      { t: "白日放歌须纵酒，青春作伴好还乡。", s: "杜甫《闻官军收河南河北》" },
      { t: "谁言寸草心，报得三春晖。", s: "孟郊《游子吟》" },
      { t: "曾经沧海难为水，除却巫山不是云。", s: "元稹《离思》" },
      { t: "十年一觉扬州梦，赢得青楼薄幸名。", s: "杜牧《遣怀》" },
      { t: "一骑红尘妃子笑，无人知是荔枝来。", s: "杜牧《过华清宫绝句》" },
      { t: "春风得意马蹄疾，一日看尽长安花。", s: "孟郊《登科后》" },
      { t: "黑发不知勤学早，白首方悔读书迟。", s: "颜真卿《劝学诗》" },
      { t: "无可奈何花落去，似曾相识燕归来。", s: "晏殊《浣溪沙》" },
      { t: "昨夜西风凋碧树，独上高楼，望尽天涯路。", s: "晏殊《蝶恋花》" },
      { t: "不畏浮云遮望眼，自缘身在最高层。", s: "王安石《登飞来峰》" },
      { t: "春风又绿江南岸，明月何时照我还。", s: "王安石《泊船瓜洲》" },
      { t: "横看成岭侧成峰，远近高低各不同。", s: "苏轼《题西林壁》" },
      { t: "不识庐山真面目，只缘身在此山中。", s: "苏轼《题西林壁》" },
      { t: "欲把西湖比西子，淡妆浓抹总相宜。", s: "苏轼《饮湖上初晴后雨》" },
      { t: "人生如梦，一尊还酹江月。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "莫道不销魂，帘卷西风，人比黄花瘦。", s: "李清照《醉花阴》" },
      { t: "生当作人杰，死亦为鬼雄。", s: "李清照《夏日绝句》" },
      { t: "千古兴亡多少事？悠悠。不尽长江滚滚流。", s: "辛弃疾《南乡子·登京口北固亭有怀》" },
      { t: "稻花香里说丰年，听取蛙声一片。", s: "辛弃疾《西江月·夜行黄沙道中》" },
      { t: "人生自古谁无死，留取丹心照汗青。", s: "文天祥《过零丁洋》" },
      { t: "不要人夸好颜色，只留清气满乾坤。", s: "王冕《墨梅》" },
      { t: "粉骨碎身浑不怕，要留清白在人间。", s: "于谦《石灰吟》" },
      { t: "落红不是无情物，化作春泥更护花。", s: "龚自珍《己亥杂诗》" },

      // 新增50篇经典古诗词与名句 (扩充版)
      { t: "春花秋月何时了？往事知多少。", s: "李煜《虞美人》" },
      { t: "小楼昨夜又东风，故国不堪回首月明中。", s: "李煜《虞美人》" },
      { t: "问君能有几多愁？恰似一江春水向东流。", s: "李煜《虞美人》" },
      { t: "剪不断，理还乱，是离愁。", s: "李煜《相见欢》" },
      { t: "别是一般滋味在心头。", s: "李煜《相见欢》" },
      { t: "流水落花春去也，天上人间。", s: "李煜《浪淘沙令》" },
      { t: "独自莫凭栏，无限江山。", s: "李煜《浪淘沙令》" },
      { t: "世事一场大梦，人生几度秋凉。", s: "苏轼《西江月》" },
      { t: "休对故人思故国，且将新火试新茶。", s: "苏轼《望江南》" },
      { t: "诗酒趁年华。", s: "苏轼《望江南》" },
      { t: "人生到处知何似，应似飞鸿踏雪泥。", s: "苏轼《和子由渑池怀旧》" },
      { t: "粗缯大布裹生涯，腹有诗书气自华。", s: "苏轼《和董传留别》" },
      { t: "博观而约取，厚积而薄发。", s: "苏轼《稼说送张琥》" },
      { t: "古之立大事者，不惟有超世之才，亦必有坚忍不拔之志。", s: "苏轼《晁错论》" },
      { t: "醉翁之意不在酒，在乎山水之间也。", s: "欧阳修《醉翁亭记》" },
      { t: "野芳发而幽香，佳木秀而繁阴。", s: "欧阳修《醉翁亭记》" },
      { t: "去年元夜时，花市灯如昼。", s: "欧阳修《生查子·元夕》" },
      { t: "月上柳梢头，人约黄昏后。", s: "欧阳修《生查子·元夕》" },
      { t: "庭院深深深几许，杨柳堆烟，帘幕无重数。", s: "欧阳修《蝶恋花》" },
      { t: "泪眼问花花不语，乱红飞过秋千去。", s: "欧阳修《蝶恋花》" },
      { t: "先天下之忧而忧，后天下之乐而乐。", s: "范仲淹《岳阳楼记》" },
      { t: "不以物喜，不以己悲。", s: "范仲淹《岳阳楼记》" },
      { t: "碧云天，黄叶地，秋色连波，波上寒烟翠。", s: "范仲淹《苏幕遮》" },
      { t: "山映斜阳天接水，芳草无情，更在斜阳外。", s: "范仲淹《苏幕遮》" },
      { t: "浊酒一杯家万里，燕然未勒归无计。", s: "范仲淹《渔家傲》" },
      { t: "人不寐，将军白发征夫泪。", s: "范仲淹《渔家傲》" },
      { t: "可怜身上衣正单，心忧炭贱愿天寒。", s: "白居易《卖炭翁》" },
      { t: "千呼万唤始出来，犹抱琵琶半遮面。", s: "白居易《琵琶行》" },
      { t: "大弦嘈嘈如急雨，小弦切切如私语。", s: "白居易《琵琶行》" },
      { t: "嘈嘈切切错杂弹，大珠小珠落玉盘。", s: "白居易《琵琶行》" },
      { t: "别有幽愁暗恨生，此时无声胜有声。", s: "白居易《琵琶行》" },
      { t: "座中泣下谁最多？江州司马青衫湿。", s: "白居易《琵琶行》" },
      { t: "乱花渐欲迷人眼，浅草才能没马蹄。", s: "白居易《钱塘湖春行》" },
      { t: "最爱湖东行不足，绿杨阴里白沙堤。", s: "白居易《钱塘湖春行》" },
      { t: "离离原上草，一岁一枯荣。", s: "白居易《赋得古原草送别》" },
      { t: "文章合为时而著，歌诗合为事而作。", s: "白居易《与元九书》" },
      { t: "曾经沧海难为水，除却巫山不是云。", s: "元稹《离思》" },
      { t: "取次花丛懒回顾，半缘修道半缘君。", s: "元稹《离思》" },
      { t: "诚知此恨人人有，贫贱夫妻百事哀。", s: "元稹《遣悲怀》" },
      { t: "十年一觉扬州梦，赢得青楼薄幸名。", s: "杜牧《遣怀》" },
      { t: "二十四桥明月夜，玉人何处教吹箫？", s: "杜牧《寄扬州韩绰判官》" },
      { t: "一骑红尘妃子笑，无人知是荔枝来。", s: "杜牧《过华清宫绝句》" },
      { t: "折戟沉沙铁未销，自将磨洗认前朝。", s: "杜牧《赤壁》" },
      { t: "东风不与周郎便，铜雀春深锁二乔。", s: "杜牧《赤壁》" },
      { t: "烟笼寒水月笼沙，夜泊秦淮近酒家。", s: "杜牧《泊秦淮》" },
      { t: "商女不知亡国恨，隔江犹唱后庭花。", s: "杜牧《泊秦淮》" },
      { t: "清明时节雨纷纷，路上行人欲断魂。", s: "杜牧《清明》" },
      { t: "借问酒家何处有？牧童遥指杏花村。", s: "杜牧《清明》" },
      { t: "多情只有春庭月，犹为离人照落花。", s: "张泌《寄人》" },
      { t: "相见时难别亦难，东风无力百花残。", s: "李商隐《无题》" },
      { t: "春蚕到死丝方尽，蜡炬成灰泪始干。", s: "李商隐《无题》" },
      { t: "晓镜但愁云鬓改，夜吟应觉月光寒。", s: "李商隐《无题》" },
      { t: "蓬山此去无多路，青鸟殷勤为探看。", s: "李商隐《无题》" },
      { t: "身无彩凤双飞翼，心有灵犀一点通。", s: "李商隐《无题》" },
      { t: "何当共剪西窗烛，却话巴山夜雨时。", s: "李商隐《夜雨寄北》" },
      { t: "君问归期未有期，巴山夜雨涨秋池。", s: "李商隐《夜雨寄北》" },
      { t: "锦瑟无端五十弦，一弦一柱思华年。", s: "李商隐《锦瑟》" },
      { t: "庄生晓梦迷蝴蝶，望帝春心托杜鹃。", s: "李商隐《锦瑟》" },
      { t: "沧海月明珠有泪，蓝田日暖玉生烟。", s: "李商隐《锦瑟》" },
      { t: "此情可待成追忆，只是当时已惘然。", s: "李商隐《锦瑟》" },
      { t: "夕阳无限好，只是近黄昏。", s: "李商隐《登乐游原》" },
      { t: "嫦娥应悔偷灵药，碧海青天夜夜心。", s: "李商隐《嫦娥》" },
      { t: "桐花万里丹山路，雏凤清于老凤声。", s: "李商隐《韩冬郎即席为诗相送》" },
      { t: "天意怜幽草，人间重晚晴。", s: "李商隐《晚晴》" },
      { t: "宣室求贤访逐臣，贾生才调更无伦。", s: "李商隐《贾生》" },
      { t: "可怜夜半虚前席，不问苍生问鬼神。", s: "李商隐《贾生》" },
      { t: "四海无闲田，农夫犹饿死。", s: "李绅《悯农》" },
      { t: "谁知盘中餐，粒粒皆辛苦。", s: "李绅《悯农》" },
      { t: "姑苏城外寒山寺，夜半钟声到客船。", s: "张继《枫桥夜泊》" },
      { t: "月落乌啼霜满天，江枫渔火对愁眠。", s: "张继《枫桥夜泊》" },
      { t: "独在异乡为异客，每逢佳节倍思亲。", s: "王维《九月九日忆山东兄弟》" },
      { t: "遥知兄弟登高处，遍插茱萸少一人。", s: "王维《九月九日忆山东兄弟》" },
      { t: "劝君更尽一杯酒，西出阳关无故人。", s: "王维《送元二使安西》" },
      { t: "大漠孤烟直，长河落日圆。", s: "王维《使至塞上》" },
      { t: "行到水穷处，坐看云起时。", s: "王维《终南别业》" },
      { t: "晚年惟好静，万事不关心。", s: "王维《终南别业》" },
      { t: "明月松间照，清泉石上流。", s: "王维《山居秋暝》" },
      { t: "随意春芳歇，王孙自可留。", s: "王维《山居秋暝》" },
      { t: "红豆生南国，春来发几枝。", s: "王维《相思》" },
      { t: "愿君多采撷，此物最相思。", s: "王维《相思》" },
      { t: "空山不见人，但闻人语响。", s: "王维《鹿柴》" },
      { t: "返景入深林，复照青苔上。", s: "王维《鹿柴》" },
      { t: "海内存知己，天涯若比邻。", s: "王勃《送杜少府之任蜀州》" },
      { t: "无为在歧路，儿女共沾巾。", s: "王勃《送杜少府之任蜀州》" },
      { t: "落霞与孤鹜齐飞，秋水共长天一色。", s: "王勃《滕王阁序》" },
      { t: "老当益壮，宁移白首之心？", s: "王勃《滕王阁序》" },
      { t: "穷且益坚，不坠青云之志。", s: "王勃《滕王阁序》" },
      { t: "前不见古人，后不见来者。", s: "陈子昂《登幽州台歌》" },
      { t: "念天地之悠悠，独怆然而涕下。", s: "陈子昂《登幽州台歌》" },
      { t: "海上生明月，天涯共此时。", s: "张九龄《望月怀远》" },
      { t: "情人怨遥夜，竟夕起相思。", s: "张九龄《望月怀远》" },
      { t: "欲穷千里目，更上一层楼。", s: "王之涣《登鹳雀楼》" },
      { t: "白日依山尽，黄河入海流。", s: "王之涣《登鹳雀楼》" },
      { t: "羌笛何须怨杨柳，春风不度玉门关。", s: "王之涣《凉州词》" },
      { t: "黄河远上白云间，一片孤城万仞山。", s: "王之涣《凉州词》" },
      { t: "葡萄美酒夜光杯，欲饮琵琶马上催。", s: "王翰《凉州词》" },
      { t: "醉卧沙场君莫笑，古来征战几人回？", s: "王翰《凉州词》" },
      { t: "秦时明月汉时关，万里长征人未还。", s: "王昌龄《出塞》" },
      { t: "但使龙城飞将在，不教胡马度阴山。", s: "王昌龄《出塞》" },
      { t: "洛阳亲友如相问，一片冰心在玉壶。", s: "王昌龄《芙蓉楼送辛渐》" },
      { t: "寒雨连江夜入吴，平明送客楚山孤。", s: "王昌龄《芙蓉楼送辛渐》" },
      { t: "两岸猿声啼不住，轻舟已过万重山。", s: "李白《早发白帝城》" },
      { t: "朝辞白帝彩云间，千里江陵一日还。", s: "李白《早发白帝城》" },
      { t: "孤帆远影碧空尽，唯见长江天际流。", s: "李白《黄鹤楼送孟浩然之广陵》" },
      { t: "故人西辞黄鹤楼，烟花三月下扬州。", s: "李白《黄鹤楼送孟浩然之广陵》" },
      { t: "飞流直下三千尺，疑是银河落九天。", s: "李白《望庐山瀑布》" },
      { t: "日照香炉生紫烟，遥看瀑布挂前川。", s: "李白《望庐山瀑布》" },
      { t: "举头望明月，低头思故乡。", s: "李白《静夜思》" },
      { t: "床前明月光，疑是地上霜。", s: "李白《静夜思》" },
      { t: "桃花潭水深千尺，不及汪伦送我情。", s: "李白《赠汪伦》" },
      { t: "李白乘舟将欲行，忽闻岸上踏歌声。", s: "李白《赠汪伦》" },
      { t: "长风破浪会有时，直挂云帆济沧海。", s: "李白《行路难》" },
      { t: "停杯投箸不能食，拔剑四顾心茫然。", s: "李白《行路难》" },
      { t: "欲渡黄河冰塞川，将登太行雪满山。", s: "李白《行路难》" },
      { t: "天生我材必有用，千金散尽还复来。", s: "李白《将进酒》" },
      { t: "人生得意须尽欢，莫使金樽空对月。", s: "李白《将进酒》" },
      { t: "君不见黄河之水天上来，奔流到海不复回。", s: "李白《将进酒》" },
      { t: "君不见高堂明镜悲白发，朝如青丝暮成雪。", s: "李白《将进酒》" },
      { t: "安能摧眉折腰事权贵，使我不得开心颜。", s: "李白《梦游天姥吟留别》" },
      { t: "大鹏一日同风起，扶摇直上九万里。", s: "李白《上李邕》" },
      { t: "仰天大笑出门去，我辈岂是蓬蒿人。", s: "李白《南陵别儿童入京》" },
      { t: "清水出芙蓉，天然去雕饰。", s: "李白《经乱离后天恩流夜郎忆旧游书怀》" },
      { t: "抽刀断水水更流，举杯消愁愁更愁。", s: "李白《宣州谢朓楼饯别校书叔云》" },
      { t: "俱怀逸兴壮思飞，欲上青天览明月。", s: "李白《宣州谢朓楼饯别校书叔云》" },
      { t: "白发三千丈，缘愁似个长。", s: "李白《秋浦歌》" },
      { t: "相看两不厌，只有敬亭山。", s: "李白《独坐敬亭山》" },
      { t: "众鸟高飞尽，孤云独去闲。", s: "李白《独坐敬亭山》" },
      { t: "小时不识月，呼作白玉盘。", s: "李白《古朗月行》" },
      { t: "又疑瑶台镜，飞在青云端。", s: "李白《古朗月行》" },
      { t: "云想衣裳花想容，春风拂槛露华浓。", s: "李白《清平调》" },
      { t: "若非群玉山头见，会向瑶台月下逢。", s: "李白《清平调》" },
      { t: "解释春风无限恨，沉香亭北倚阑干。", s: "李白《清平调》" },
      { t: "名花倾国两相欢，长得君王带笑看。", s: "李白《清平调》" },
      { t: "会当凌绝顶，一览众山小。", s: "杜甫《望岳》" },
      { t: "岱宗夫如何？齐鲁青未了。", s: "杜甫《望岳》" },
      { t: "造化钟神秀，阴阳割昏晓。", s: "杜甫《望岳》" },
      { t: "国破山河在，城春草木深。", s: "杜甫《春望》" },
      { t: "感时花溅泪，恨别鸟惊心。", s: "杜甫《春望》" },
      { t: "烽火连三月，家书抵万金。", s: "杜甫《春望》" },
      { t: "白头搔更短，浑欲不胜簪。", s: "杜甫《春望》" },
      { t: "无边落木萧萧下，不尽长江滚滚来。", s: "杜甫《登高》" },
      { t: "万里悲秋常作客，百年多病独登台。", s: "杜甫《登高》" },
      { t: "艰难苦恨繁霜鬓，潦倒新停浊酒杯。", s: "杜甫《登高》" },
      { t: "风急天高猿啸哀，渚清沙白鸟飞回。", s: "杜甫《登高》" },
      { t: "好雨知时节，当春乃发生。", s: "杜甫《春夜喜雨》" },
      { t: "随风潜入夜，润物细无声。", s: "杜甫《春夜喜雨》" },
      { t: "野径云俱黑，江船火独明。", s: "杜甫《春夜喜雨》" },
      { t: "晓看红湿处，花重锦官城。", s: "杜甫《春夜喜雨》" },
      { t: "两个黄鹂鸣翠柳，一行白鹭上青天。", s: "杜甫《绝句》" },
      { t: "窗含西岭千秋雪，门泊东吴万里船。", s: "杜甫《绝句》" },
      { t: "白日放歌须纵酒，青春作伴好还乡。", s: "杜甫《闻官军收河南河北》" },
      { t: "剑外忽传收蓟北，初闻涕泪满衣裳。", s: "杜甫《闻官军收河南河北》" },
      { t: "却看妻子愁何在，漫卷诗书喜欲狂。", s: "杜甫《闻官军收河南河北》" },
      { t: "即从巴峡穿巫峡，便下襄阳向洛阳。", s: "杜甫《闻官军收河南河北》" },
      { t: "正是江南好风景，落花时节又逢君。", s: "杜甫《江南逢李龟年》" },
      { t: "岐王宅里寻常见，崔九堂前几度闻。", s: "杜甫《江南逢李龟年》" },
      { t: "露从今夜白，月是故乡明。", s: "杜甫《月夜忆舍弟》" },
      { t: "寄书长不达，况乃未休兵。", s: "杜甫《月夜忆舍弟》" },
      { t: "为人性僻耽佳句，语不惊人死不休。", s: "杜甫《江上值水如海势聊短述》" },
      { t: "读书破万卷，下笔如有神。", s: "杜甫《奉赠韦左丞丈二十二韵》" },
      { t: "朱门酒肉臭，路有冻死骨。", s: "杜甫《自京赴奉先县咏怀五百字》" },
      { t: "安得广厦千万间，大庇天下寒士俱欢颜。", s: "杜甫《茅屋为秋风所破歌》" },
      { t: "何时眼前突兀见此屋，吾庐独破受冻死亦足！", s: "杜甫《茅屋为秋风所破歌》" },
      { t: "出师未捷身先死，长使英雄泪满襟。", s: "杜甫《蜀相》" },
      { t: "丞相祠堂何处寻？锦官城外柏森森。", s: "杜甫《蜀相》" },
      { t: "映阶碧草自春色，隔叶黄鹂空好音。", s: "杜甫《蜀相》" },
      { t: "三顾频烦天下计，两朝开济老臣心。", s: "杜甫《蜀相》" },
      { t: "尔曹身与名俱灭，不废江河万古流。", s: "杜甫《戏为六绝句》" },
      { t: "慈母手中线，游子身上衣。", s: "孟郊《游子吟》" },
      { t: "临行密密缝，意恐迟迟归。", s: "孟郊《游子吟》" },
      { t: "谁言寸草心，报得三春晖。", s: "孟郊《游子吟》" },
      { t: "春风得意马蹄疾，一日看尽长安花。", s: "孟郊《登科后》" },
      { t: "昔日龌龊不足夸，今朝放荡思无涯。", s: "孟郊《登科后》" },
      { t: "人面桃花相映红。", s: "崔护《题都城南庄》" },
      { t: "去年今日此门中，人面桃花相映红。", s: "崔护《题都城南庄》" },
      { t: "人面不知何处去，桃花依旧笑春风。", s: "崔护《题都城南庄》" },
      { t: "谁知盘中餐，粒粒皆辛苦。", s: "李绅《悯农》" },
      { t: "锄禾日当午，汗滴禾下土。", s: "李绅《悯农》" },
      { t: "春种一粒粟，秋收万颗子。", s: "李绅《悯农》" },
      { t: "四海无闲田，农夫犹饿死。", s: "李绅《悯农》" },
      { t: "千山鸟飞绝，万径人踪灭。", s: "柳宗元《江雪》" },
      { t: "孤舟蓑笠翁，独钓寒江雪。", s: "柳宗元《江雪》" },
      { t: "沉舟侧畔千帆过，病树前头万木春。", s: "刘禹锡《酬乐天扬州初逢席上见赠》" },
      { t: "东边日出西边雨，道是无晴却有晴。", s: "刘禹锡《竹枝词》" },
      { t: "旧时王谢堂前燕，飞入寻常百姓家。", s: "刘禹锡《乌衣巷》" },
      { t: "朱雀桥边野草花，乌衣巷口夕阳斜。", s: "刘禹锡《乌衣巷》" },
      { t: "莫道桑榆晚，为霞尚满天。", s: "刘禹锡《酬乐天咏老见示》" },
      { t: "自古逢秋悲寂寥，我言秋日胜春朝。", s: "刘禹锡《秋词》" },
      { t: "晴空一鹤排云上，便引诗情到碧霄。", s: "刘禹锡《秋词》" },
      { t: "遥望洞庭山水翠，白银盘里一青螺。", s: "刘禹锡《望洞庭》" },
      { t: "湖光秋月两相和，潭面无风镜未磨。", s: "刘禹锡《望洞庭》" },
      { t: "可怜九月初三夜，露似真珠月似弓。", s: "白居易《暮江吟》" },
      { t: "一道残阳铺水中，半江瑟瑟半江红。", s: "白居易《暮江吟》" },
      { t: "日出江花红胜火，春来江水绿如蓝。", s: "白居易《忆江南》" },
      { t: "能不忆江南？", s: "白居易《忆江南》" },
      { t: "江南好，风景旧曾谙。", s: "白居易《忆江南》" },
      { t: "试玉要烧三日满，辨材须待七年期。", s: "白居易《放言五首·其三》" },
      { t: "向使当初身便死，一生真伪复谁知？", s: "白居易《放言五首·其三》" },
      { t: "同是天涯沦落人，相逢何必曾相识。", s: "白居易《琵琶行》" },
      { t: "在天愿作比翼鸟，在地愿为连理枝。", s: "白居易《长恨歌》" },
      { t: "天长地久有时尽，此恨绵绵无绝期。", s: "白居易《长恨歌》" },
      { t: "回眸一笑百媚生，六宫粉黛无颜色。", s: "白居易《长恨歌》" },
      { t: "遂令天下父母心，不重生男重生女。", s: "白居易《长恨歌》" },
      { t: "野火烧不尽，春风吹又生。", s: "白居易《赋得古原草送别》" },
      { t: "离离原上草，一岁一枯荣。", s: "白居易《赋得古原草送别》" },
      { t: "晴川历历汉阳树，芳草萋萋鹦鹉洲。", s: "崔颢《黄鹤楼》" },
      { t: "日暮乡关何处是？烟波江上使人愁。", s: "崔颢《黄鹤楼》" },
      { t: "昔人已乘黄鹤去，此地空余黄鹤楼。", s: "崔颢《黄鹤楼》" },
      { t: "黄鹤一去不复返，白云千载空悠悠。", s: "崔颢《黄鹤楼》" },
      { t: "近乡情更怯，不敢问来人。", s: "宋之问《渡汉江》" },
      { t: "岭外音书断，经冬复历春。", s: "宋之问《渡汉江》" },
      { t: "少小离家老大回，乡音无改鬓毛衰。", s: "贺知章《回乡偶书》" },
      { t: "儿童相见不相识，笑问客从何处来。", s: "贺知章《回乡偶书》" },
      { t: "碧玉妆成一树高，万条垂下绿丝绦。", s: "贺知章《咏柳》" },
      { t: "不知细叶谁裁出，二月春风似剪刀。", s: "贺知章《咏柳》" },
      { t: "独怜幽草涧边生，上有黄鹂深树鸣。", s: "韦应物《滁州西涧》" },
      { t: "春潮带雨晚来急，野渡无人舟自横。", s: "韦应物《滁州西涧》" },
      { t: "黑发不知勤学早，白首方悔读书迟。", s: "颜真卿《劝学诗》" },
      { t: "三更灯火五更鸡，正是男儿读书时。", s: "颜真卿《劝学诗》" },
      { t: "爆竹声中一岁除，春风送暖入屠苏。", s: "王安石《元日》" },
      { t: "千门万户瞳瞳日，总把新桃换旧符。", s: "王安石《元日》" },
      { t: "墙角数枝梅，凌寒独自开。", s: "王安石《梅花》" },
      { t: "遥知不是雪，为有暗香来。", s: "王安石《梅花》" },
      { t: "不畏浮云遮望眼，自缘身在最高层。", s: "王安石《登飞来峰》" },
      { t: "飞来山上千寻塔，闻说鸡鸣见日升。", s: "王安石《登飞来峰》" },
      { t: "春风又绿江南岸，明月何时照我还。", s: "王安石《泊船瓜洲》" },
      { t: "京口瓜洲一水间，钟山只隔数重山。", s: "王安石《泊船瓜洲》" },
      { t: "无可奈何花落去，似曾相识燕归来。", s: "晏殊《浣溪沙》" },
      { t: "一曲新词酒一杯，去年天气旧亭台。", s: "晏殊《浣溪沙》" },
      { t: "夕阳西下几时回？", s: "晏殊《浣溪沙》" },
      { t: "昨夜西风凋碧树，独上高楼，望尽天涯路。", s: "晏殊《蝶恋花》" },
      { t: "欲把西湖比西子，淡妆浓抹总相宜。", s: "苏轼《饮湖上初晴后雨》" },
      { t: "水光潋滟晴方好，山色空蒙雨亦奇。", s: "苏轼《饮湖上初晴后雨》" },
      { t: "横看成岭侧成峰，远近高低各不同。", s: "苏轼《题西林壁》" },
      { t: "不识庐山真面目，只缘身在此山中。", s: "苏轼《题西林壁》" },
      { t: "竹外桃花三两枝，春江水暖鸭先知。", s: "苏轼《惠崇春江晚景》" },
      { t: "蒌蒿满地芦芽短，正是河豚欲上时。", s: "苏轼《惠崇春江晚景》" },
      { t: "大江东去，浪淘尽，千古风流人物。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "乱石穿空，惊涛拍岸，卷起千堆雪。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "江山如画，一时多少豪杰。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "人生如梦，一尊还酹江月。", s: "苏轼《念奴娇·赤壁怀古》" },
      { t: "十年生死两茫茫，不思量，自难忘。", s: "苏轼《江城子》" },
      { t: "千里孤坟，无处话凄凉。", s: "苏轼《江城子》" },
      { t: "纵使相逢应不识，尘满面，鬓如霜。", s: "苏轼《江城子》" },
      { t: "会挽雕弓如满月，西北望，射天狼。", s: "苏轼《江城子·密州出猎》" },
      { t: "老夫聊发少年狂，左牵黄，右擎苍。", s: "苏轼《江城子·密州出猎》" },
      { t: "明月几时有？把酒问青天。", s: "苏轼《水调歌头》" },
      { t: "不知天上宫阙，今夕是何年。", s: "苏轼《水调歌头》" },
      { t: "我欲乘风归去，又恐琼楼玉宇，高处不胜寒。", s: "苏轼《水调歌头》" },
      { t: "起舞弄清影，何似在人间。", s: "苏轼《水调歌头》" },
      { t: "人有悲欢离合，月有阴晴圆缺，此事古难全。", s: "苏轼《水调歌头》" },
      { t: "但愿人长久，千里共婵娟。", s: "苏轼《水调歌头》" },
      { t: "莫听穿林打叶声，何妨吟啸且徐行。", s: "苏轼《定风波》" },
      { t: "竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。", s: "苏轼《定风波》" },
      { t: "回首向来萧瑟处，归去，也无风雨也无晴。", s: "苏轼《定风波》" },
      { t: "天接云涛连晓雾，星河欲转千帆舞。", s: "李清照《渔家傲》" },
      { t: "九万里风鹏正举。风休住，蓬舟吹取三山去！", s: "李清照《渔家傲》" },
      { t: "生当作人杰，死亦为鬼雄。", s: "李清照《夏日绝句》" },
      { t: "至今思项羽，不肯过江东。", s: "李清照《夏日绝句》" },
      { t: "寻寻觅觅，冷冷清清，凄凄惨惨戚戚。", s: "李清照《声声慢》" },
      { t: "这次第，怎一个愁字了得！", s: "李清照《声声慢》" },
      { t: "花自飘零水自流，一种相思，两处闲愁。", s: "李清照《一剪梅》" },
      { t: "此情无计可消除，才下眉头，却上心头。", s: "李清照《一剪梅》" },
      { t: "知否，知否？应是绿肥红瘦。", s: "李清照《如梦令》" },
      { t: "昨夜雨疏风骤，浓睡不消残酒。", s: "李清照《如梦令》" },
      { t: "常记溪亭日暮，沉醉不知归路。", s: "李清照《如梦令》" },
      { t: "兴尽晚回舟，误入藕花深处。", s: "李清照《如梦令》" },
      { t: "争渡，争渡，惊起一滩鸥鹭。", s: "李清照《如梦令》" },
      { t: "莫道不销魂，帘卷西风，人比黄花瘦。", s: "李清照《醉花阴》" },
      { t: "东篱把酒黄昏后，有暗香盈袖。", s: "李清照《醉花阴》" },
      { t: "众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。", s: "辛弃疾《青玉案·元夕》" },
      { t: "东风夜放花千树，更吹落，星如雨。", s: "辛弃疾《青玉案·元夕》" },
      { t: "宝马雕车香满路。", s: "辛弃疾《青玉案·元夕》" },
      { t: "凤箫声动，玉壶光转，一夜鱼龙舞。", s: "辛弃疾《青玉案·元夕》" },
      { t: "醉里挑灯看剑，梦回吹角连营。", s: "辛弃疾《破阵子》" },
      { t: "八百里分麾下炙，五十弦翻塞外声。", s: "辛弃疾《破阵子》" },
      { t: "沙场秋点兵。", s: "辛弃疾《破阵子》" },
      { t: "马作的卢飞快，弓如霹雳弦惊。", s: "辛弃疾《破阵子》" },
      { t: "了却君王天下事，赢得生前身后名。", s: "辛弃疾《破阵子》" },
      { t: "可怜白发生！", s: "辛弃疾《破阵子》" },
      { t: "想当年，金戈铁马，气吞万里如虎。", s: "辛弃疾《永遇乐·京口北固亭怀古》" },
      { t: "千古江山，英雄无觅孙仲谋处。", s: "辛弃疾《永遇乐·京口北固亭怀古》" },
      { t: "凭谁问：廉颇老矣，尚能饭否？", s: "辛弃疾《永遇乐·京口北固亭怀古》" },
      { t: "少年不识愁滋味，爱上层楼。", s: "辛弃疾《丑奴儿·书博山道中壁》" },
      { t: "爱上层楼，为赋新词强说愁。", s: "辛弃疾《丑奴儿·书博山道中壁》" },
      { t: "而今识尽愁滋味，欲说还休。", s: "辛弃疾《丑奴儿·书博山道中壁》" },
      { t: "欲说还休，却道天凉好个秋。", s: "辛弃疾《丑奴儿·书博山道中壁》" },
      { t: "稻花香里说丰年，听取蛙声一片。", s: "辛弃疾《西江月·夜行黄沙道中》" },
      { t: "七八个星天外，两三点雨山前。", s: "辛弃疾《西江月·夜行黄沙道中》" },
      { t: "旧时茅店社林边，路转溪桥忽见。", s: "辛弃疾《西江月·夜行黄沙道中》" },
      { t: "千古兴亡多少事？悠悠。不尽长江滚滚流。", s: "辛弃疾《南乡子·登京口北固亭有怀》" },
      { t: "何处望神州？满眼风光北固楼。", s: "辛弃疾《南乡子·登京口北固亭有怀》" },
      { t: "生子当如孙仲谋。", s: "辛弃疾《南乡子·登京口北固亭有怀》" },
      { t: "怒发冲冠，凭栏处、潇潇雨歇。", s: "岳飞《满江红》" },
      { t: "三十功名尘与土，八千里路云和月。", s: "岳飞《满江红》" },
      { t: "莫等闲，白了少年头，空悲切。", s: "岳飞《满江红》" },
      { t: "壮志饥餐胡虏肉，笑谈渴饮匈奴血。", s: "岳飞《满江红》" },
      { t: "待从头、收拾旧山河，朝天阙。", s: "岳飞《满江红》" },
      { t: "接天莲叶无穷碧，映日荷花别样红。", s: "杨万里《晓出净慈寺送林子方》" },
      { t: "毕竟西湖六月中，风光不与四时同。", s: "杨万里《晓出净慈寺送林子方》" },
      { t: "小荷才露尖尖角，早有蜻蜓立上头。", s: "杨万里《小池》" },
      { t: "泉眼无声惜细流，树阴照水爱晴柔。", s: "杨万里《小池》" },
      { t: "等闲识得东风面，万紫千红总是春。", s: "朱熹《春日》" },
      { t: "胜日寻芳泗水滨，无边光景一时新。", s: "朱熹《春日》" },
      { t: "问渠那得清如许？为有源头活水来。", s: "朱熹《观书有感》" },
      { t: "半亩方塘一鉴开，天光云影共徘徊。", s: "朱熹《观书有感》" },
      { t: "人生自古谁无死，留取丹心照汗青。", s: "文天祥《过零丁洋》" },
      { t: "辛苦遭逢起一经，干戈寥落四周星。", s: "文天祥《过零丁洋》" },
      { t: "山河破碎风飘絮，身世浮沉雨打萍。", s: "文天祥《过零丁洋》" },
      { t: "惶恐滩头说惶恐，零丁洋里叹零丁。", s: "文天祥《过零丁洋》" },
      { t: "不要人夸好颜色，只留清气满乾坤。", s: "王冕《墨梅》" },
      { t: "吾家洗砚池头树，个个花开淡墨痕。", s: "王冕《墨梅》" },
      { t: "千磨万击还坚劲，任尔东西南北风。", s: "郑燮《竹石》" },
      { t: "咬定青山不放松，立根原在破岩中。", s: "郑燮《竹石》" },
      { t: "粉骨碎身浑不怕，要留清白在人间。", s: "于谦《石灰吟》" },
      { t: "千锤万凿出深山，烈火焚烧若等闲。", s: "于谦《石灰吟》" },
      { t: "九州生气恃风雷，万马齐喑究可哀。", s: "龚自珍《己亥杂诗》" },
      { t: "我劝天公重抖擞，不拘一格降人才。", s: "龚自珍《己亥杂诗》" },
      { t: "落红不是无情物，化作春泥更护花。", s: "龚自珍《己亥杂诗》" },
      { t: "浩荡离愁白日斜，吟鞭东指即天涯。", s: "龚自珍《己亥杂诗》" }
    ];

    const mockeryLib = [
      "手是借来的吗？", "键盘上撒把米，鸡都比你打得准。", "你是二指禅传人？", "这种速度，蜗牛都睡着了。", 
      "建议去医院检查一下手指。", "键盘：我做错了什么？", "这是脸滚键盘出来的吗？", "打字慢就算了，还打错？",
      "你的语文老师在哭泣。", "这操作，令人窒息。", "我奶奶打字都比你快。", "你是来搞笑的吗？",
      "别按了，键盘会痛。", "这是什么神仙手速（反话）。", "需要帮你叫救护车吗？手抽筋没？", "这种水平也敢来挑战？",
      "退下吧，凡人。", "你的手和脑子断连了吗？", "这字是你发明的？", "再错电脑要自爆了。",
      "打字如便秘，半天挤不出一个屁。", "建议把手捐给有需要的人。", "你的键盘在哭泣，听见了吗？", "这速度，乌龟看了都直摇头。",
      "是不是把键盘当钢琴弹了？瞎几把按。", "这种操作，只有在梦里才能即使更正。", "你的语文老师棺材板按不住了。", "手残党终身成就奖得主。",
      "你是派来折磨键盘的卧底吗？", "这手速，是在绣花吗？", "我看你还是去搬砖吧，那个不费脑子。", "打字这么慢，是不是在思考人生？",
      "这种水平，也就只能去打打地鼠了。", "键盘上撒把米，鸡都比你快。", "你的手指是借来的吗？记得还回去。", "别挣扎了，放弃吧，打字不适合你。"
    ];

    // --- 嘲讽库 (分级) ---
    const mockeryLevels = {
        level10: [ // 10秒：轻度提醒/加油
            "加油加油！速度稍微有点慢哦~",
            "热身结束了吗？开始加速吧！",
            "别走神，键盘在等你呢。",
            "深呼吸，找回你的节奏。",
            "相信自己，你可以更快的！"
        ],
        level20: [ // 20秒：中度嘲讽
            "键盘上是涂了胶水吗？",
            "蜗牛正在超车，请注意避让。",
            "你是在给每个键做按摩吗？",
            "这种速度，泡面都凉了。",
            "手指是借来的吗？记得还回去。",
            "是不是在偷偷回微信？专心点！"
        ],
        level30: [ // 30秒：重度嘲讽
            "键盘在哭泣：求求你按我一下！",
            "我奶奶用一根手指都比你快。",
            "这种手速，抢红包都抢不到一分钱。",
            "建议开启“老年人模式”。",
            "你是树懒转世吗？",
            "打字如便秘，半天挤不出一个字。",
            "别挣扎了，承认自己手残吧。"
        ],
        level60: [ // 60秒：地狱级嘲讽
            "毁灭吧，累了。",
            "需要帮你叫个代打吗？",
            "这种效率，老板看了想打人。",
            "你是在用脚打字吗？",
            "连输入法都想卸载自己了。",
            "放弃吧，打字可能真的不适合你。",
            "你的键盘已经睡着了，别吵醒它。"
        ]
    };
    
    // 原有的 slowMockeryLib 可以保留或移除，这里为了兼容先保留但不再使用
    const slowMockeryLib = [];

    const praiseLib = [
      "你打字的样子，像极了爱情。", 
      "别打字了，直接打动我的心吧。",
      "这是什么神仙手速？是在我的心弦上弹奏吗？", 
      "你指尖流淌的不是代码，是星河滚烫。",
      "你每敲一下键盘，我的心跳就为你漏一拍。", 
      "糟糕，是心动的感觉！这手速简直犯规。",
      "如果打字有段位，你一定是荣耀王者。", 
      "看到你打字，我连孩子的名字都想好了。",
      "你的手被天使吻过吗？怎么可以这么灵动。", 
      "这行云流水的操作，简直是在给键盘做马杀鸡。",
      "你是不是偷偷给键盘施了魔法？", 
      "这种速度，只有单身二十年的手速……啊不，是天选之子的手速！",
      "键盘都要被你迷晕了，每一个键都在喊爱你。", 
      "你打的每一个字，都精准地击中了我的心巴。",
      "这手速，是吃了德芙吗？这么丝滑。", 
      "确认过眼神，是能Carry全场的打字英雄。",
      "你的指尖有魔法，把枯燥的文字变成了乐章。", 
      "不要这么快，我的眼睛跟不上你的光速，但心跟得上。",
      "这波操作，我愿称之为绝绝子！", 
      "你就是传说中的键盘侠……啊不，键盘艺术家！",
      "看着你打字，我突然觉得键盘都变得性感起来了。", 
      "你的手速，大概就是我心动的频率。",
      "这哪里是打字，简直是在键盘上跳华尔兹。", 
      "你这么优秀，键盘知道吗？",
      "我怀疑你的手指装了涡轮增压。", 
      "这种丝滑程度，简直比你的发际线还要顺滑（开玩笑的，你最美）。",
      "你打字的背影，比敲代码的程序员还要迷人一万倍。", 
      "这手速，连光纤都觉得惭愧。",
      "你不是在输入文字，你是在编织梦境。", 
      "如果帅气/美丽可以当饭吃，你这手速已经喂饱了全世界。",
      "键盘如果有灵魂，此刻一定在为你欢呼。", 
      "你指尖跃动的电光，是我此生不变的信仰。",
      "这操作，秀得我头皮发麻，爱意泛滥。", 
      "你就是打字界的博尔特，不仅快，而且帅。"
    ];

    // --- 游戏结束嘲讽库 ---
    const gameOverMockery = [
      "1分钟了……你是想把键盘坐穿吗？",
      "键盘：我累了，毁灭吧。",
      "这首诗都要被你打发霉了。",
      "乌龟都爬到终点了，你还在看风景。",
      "你的手速成功治好了我的低血压。",
      "建议直接把键盘捐给有需要的人。",
      "打字慢不是你的错，但坚持这么慢就是你的不对了。",
      "你是来这里修身养性的吗？",
      "这种速度，连输入法都想报警。",
      "1分钟，够泡一碗面了，你却还没打完一首诗。",
      "我怀疑你在用一种很新的方式打字。",
      "你的手指是被502胶水粘住了吗？",
      "这速度，大概是在给每个按键做超度。",
      "别打了，去睡一觉吧，梦里啥都有。",
      "这种效率，我在你身上看到了树懒的影子。",
      "键盘：求求你给我个痛快吧。",
      "你是在打字，还是在给键盘除尘？",
      "这种手速，抢红包连包装袋都看不到。",
      "放弃吧，也许语音输入更适合你。",
      "你的时间非常值钱，但显然不是现在。"
    ];

    // --- 2. 状态管理 ---
    const state = {
      targetText: "",
      targetPinyin: [], // 存储拼音数组
      targetSource: "",
      gameStartTime: null, // 游戏总开始时间
      gameTimerInterval: null,
      currentStartTime: null, // 当前句开始时间
      currentTimerInterval: null,
      isComposing: false, // 是否正在拼音输入
      errorCount: 0,
      totalChars: 0,
      completed: false,
      lastInputVal: "",
      bgmEnabled: false,
      sfxEnabled: true,
      combo: 0,
      maxCombo: 0,
      stopEffectsTimer: null, // 特效关闭定时器
      slowCheckTimer10: null,   // 慢速检测定时器 10s
      slowCheckTimer20: null,   // 慢速检测定时器 20s
      slowCheckTimer30: null,   // 慢速检测定时器 30s
      slowCheckTimer60: null,   // 慢速检测定时器 60s
      gameOverTimer: null,      // 游戏结束检测定时器 60s
      
      // 长期统计 (本局)
      session: {
        completedCount: 0,
        totalWpm: 0,
        totalAcc: 0
      }
    };

    const els = {
      textDisplay: document.getElementById("text-display"),
      sourceTag: document.getElementById("source-tag"),
      input: document.getElementById("input-field"),
      wpm: document.getElementById("wpm"),
      wpmCircle: document.getElementById("wpm-circle"),
      accuracy: document.getElementById("accuracy"),
      accuracyCircle: document.getElementById("accuracy-circle"),
      progressText: document.getElementById("progress-text"),
      progressCircle: document.getElementById("progress-circle"),
      
      avgWpm: document.getElementById("avg-wpm"),
      avgWpmCircle: document.getElementById("avg-wpm-circle"),
      avgAcc: document.getElementById("avg-accuracy"),
      avgAccCircle: document.getElementById("avg-accuracy-circle"),
      
      toast: document.getElementById("toast"),
      canvas: document.getElementById("fireworks"),
      btnBgm: document.getElementById("btn-bgm"),
      btnSfx: document.getElementById("btn-sfx"),
      comboContainer: document.getElementById("combo-container"),
      comboCount: document.getElementById("combo-count"),
      timerVal: document.getElementById("timer-val"),
      timerRing: document.querySelector(".timer-meter.small .timer-ring"),
      currentTimerVal: document.getElementById("current-timer-val"),
      currentTimerRing: document.getElementById("current-timer-ring"),
      comboProgressArea: document.getElementById("combo-progress-area"),
      comboBar: document.getElementById("combo-bar"),
      milestone100: document.getElementById("milestone-100"),
      milestone200: document.getElementById("milestone-200")
    };

    const CIRCLE_CIRCUMFERENCE = 2 * Math.PI * 40; // 251.32
    const CIRCLE_CIRCUMFERENCE_SMALL = 2 * Math.PI * 32; // 201.06

    // --- 3. 音频引擎 (Simple Audio - audio_test.html 风格) ---
    // 音频文件路径常量
    const SOUND_PATHS = {
        click: 'tipssound/clickonce.mp3',
        error: 'tipssound/wrong.mp3',
        explosion: 'tipssound/fireworks.mp3',
        bell: 'tipssound/hurryup.mp3',
        bgm: './bgm.mp3',
        v3: './v3.m4a',
        waltz: './waltz.mp3',
        gameover: './gameover.mp3'
    };

    const AudioEngine = {
      // 背景音乐播放器 (单例)
      bgmPlayer: new Audio(SOUND_PATHS.waltz),
      currentBgmType: 'waltz', 
      isPlayingBgm: false,
      
      // 语音播放器 (单例复用，以规避自动播放策略)
      voicePlayer: new Audio(),
      
      init() {
          console.log("AudioEngine (Simple) initializing...");
          this.bgmPlayer.volume = 0.2;
          this.bgmPlayer.loop = true;
          
          Object.values(SOUND_PATHS).forEach(src => {
              const a = new Audio(src);
              a.preload = 'auto'; 
          });
          
          // 移除 fetch 探测，因为它在 file:// 协议下会误报 CORS 错误
      },
      
      // 恢复语音播放 (回归最简模式 - 完全复刻 audio_test.html)
      playVoice(filename) {
          // 1. 使用相对路径，与 audio_test.html 保持一致
          const src = `./audio_assets/${filename}.mp3`;
          console.log(`[AudioEngine] Playing voice: ${src}`);
          
          try {
              // 2. 每次新建 Audio 对象，不复用，不加复杂逻辑
              const audio = new Audio(src);
              audio.volume = 1.0;
              
              // 3. 简单的打断逻辑 (可选，为了体验)
              if (this.currentVoicePlayer) {
                  this.currentVoicePlayer.pause();
                  this.currentVoicePlayer.currentTime = 0;
              }
              this.currentVoicePlayer = audio;
              
              // 4. 直接播放，不加 Promise 处理，让错误自然抛出或被忽略
              audio.play().catch(e => {
                  console.error(`[AudioEngine] Voice play failed (${src}):`, e);
                  // 只有非打断错误才弹窗
                  if (e.name !== 'AbortError' && typeof showToast === 'function') {
                      showToast(`语音播放失败: ${e.message}`, false);
                  }
              });
              
              audio.onended = () => {
                  if (this.currentVoicePlayer === audio) {
                      this.currentVoicePlayer = null;
                  }
              };
          } catch (e) {
              console.error("[AudioEngine] Error creating audio:", e);
          }
      },
      
      startBgm() {
          if (this.isPlayingBgm) return;
          this._playBgm();
      },
      
      _playBgm() {
          // 确保 loop 和 volume
          this.bgmPlayer.loop = true;
          this.bgmPlayer.volume = 0.2;
          
          this.bgmPlayer.play().then(() => {
              this.isPlayingBgm = true;
          }).catch(e => {
              console.error("BGM play failed:", e);
          });
      },
      
      switchBgm(type) {
          if (!state.bgmEnabled) return;
          if (this.currentBgmType === type) return; // 相同则跳过
          
          // 1. 暂停当前
          this.bgmPlayer.pause();
          this.bgmPlayer.currentTime = 0; // 重置
          
          // 2. 切换源
          let newSrc;
          if (type === 'turkish') newSrc = SOUND_PATHS.bgm;
          else if (type === 'v3') newSrc = SOUND_PATHS.v3;
          else if (type === 'gameover') newSrc = SOUND_PATHS.gameover;
          else newSrc = SOUND_PATHS.waltz;
          
          this.bgmPlayer.src = newSrc;
          this.currentBgmType = type;
          
          // 3. 如果正在播放状态，则继续播放新曲目
          if (this.isPlayingBgm) {
              this._playBgm();
          }
      },
      
      stopBgm() {
          this.bgmPlayer.pause();
          this.isPlayingBgm = false;
      },
      
      // 通用音效播放函数 (每次 new Audio)
      _playSound(path, volume = 1.0, playbackRate = 1.0) {
          if (!state.sfxEnabled) return;
          
          try {
              const audio = new Audio(path);
              audio.volume = volume;
              audio.playbackRate = playbackRate;
              
              // 播放并销毁 (GC 会自动回收)
              audio.play().catch(e => {
                  // 忽略 AbortError (快速切换时可能发生)
                  if (e.name !== 'AbortError') console.error(`Sound play failed (${path}):`, e);
              });
          } catch (e) {
              console.error("Sound creation error:", e);
          }
      },
      
      // 兼容接口：playTone (空实现或简单替代)
      playTone(freq, duration, type, vol) {
          // 简单模式下不再支持频率合成，直接忽略或用 bell 代替
          // this.playBell(); 
      },

      // 播放错误音效
      playError() {
        this._playSound(SOUND_PATHS.error, 0.8);
      },

      // 机械键盘敲击
      playClick() {
        // 稍微随机化音量和速率，增加真实感
        const rate = 0.9 + Math.random() * 0.2;
        this._playSound(SOUND_PATHS.click, 0.6, rate);
      },

      // 播放铃铛声
      playBell() {
        this._playSound(SOUND_PATHS.bell, 0.8);
      },

      // 高级爆炸音效
      playExplosion() {
        // 音量减半 (1.0 -> 0.5)
        this._playSound(SOUND_PATHS.explosion, 0.5);
      },
      
      // 兼容接口：resumeCtx (空实现，因为 new Audio 不需要 resume Context)
      resumeCtx() {
          // do nothing
      }
    };

    // 5. 事件监听
    els.btnSfx.addEventListener("click", () => {
      AudioEngine.init();
      state.sfxEnabled = !state.sfxEnabled;
      els.btnSfx.classList.toggle("off", !state.sfxEnabled);
    });

    els.btnBgm.addEventListener("click", () => {
        state.bgmEnabled = !state.bgmEnabled;
        els.btnBgm.classList.toggle("off", !state.bgmEnabled);
        
        if (state.bgmEnabled) {
            AudioEngine.init();
            AudioEngine.startBgm();
        } else {
            AudioEngine.stopBgm();
        }
    });

    // --- 游戏主控逻辑 ---
    // 定义在全局，防止变量提升问题
    function startGame() {
        const overlay = document.getElementById('start-overlay');
        overlay.classList.add('hide');
        
        // 启动总计时器
        if (state.gameTimerInterval) clearInterval(state.gameTimerInterval);
        
        state.gameStartTime = Date.now();
        els.timerRing.style.animationPlayState = 'running';
        
        state.gameTimerInterval = setInterval(() => {
            if (state.completed) return; // 胜利后停止更新显示
            const elapsed = Date.now() - state.gameStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            els.timerVal.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 100);

        // 强制开启并播放BGM
        state.bgmEnabled = true;
        els.btnBgm.classList.remove("off");
        
        // 初始化音频引擎 (用户交互后才能播放)
        AudioEngine.init();
        AudioEngine.startBgm();

        init();
    }
    
    // 绑定开始按钮 (直接绑定 + DOMContentLoaded 双重保障)
    // 增加回车键开始逻辑
    const startBtn = document.getElementById('start-btn');
    const bindStartEvents = () => {
        const btn = document.getElementById('start-btn');
        if (btn) btn.addEventListener('click', startGame);
        
        window.addEventListener('keydown', (e) => {
            const overlay = document.getElementById('start-overlay');
            if (e.key === 'Enter' && overlay && !overlay.classList.contains('hide')) {
                startGame();
            }
        });
    };

    if (startBtn) {
        bindStartEvents();
    } else {
        window.addEventListener('DOMContentLoaded', bindStartEvents);
    }

    // --- 4. 核心逻辑 ---
    
    // 初始化时不要自动开始，等待用户点击
    function init(keepCombo = false) {
      // 如果不保持Combo，重置进度条
      if (!keepCombo) {
          state.combo = 0;
          els.comboBar.style.width = '0%';
          els.comboProgressArea.classList.remove('active');
          // 重置里程碑
          if (els.milestone100) els.milestone100.classList.remove('reached');
          if (els.milestone200) els.milestone200.classList.remove('reached');
      }

      const item = rawTextLib[Math.floor(Math.random() * rawTextLib.length)];
      state.targetText = item.t;
      state.targetSource = item.s;
      
      if (state.targetText.length > 20) {
        state.targetText = state.targetText.substring(0, 20);
      }
      
      // 生成拼音 (带声调)
      if (window.pinyinPro) {
          const { pinyin } = window.pinyinPro;
          state.targetPinyin = pinyin(state.targetText, { type: 'array', toneType: 'symbol' });
      } else {
          // 降级处理
          state.targetPinyin = state.targetText.split('').map(() => '');
      }
      
      state.startTime = null; // 单句开始时间 (用于WPM计算)
      state.currentStartTime = null; // 重置当前句计时器
      if (state.currentTimerInterval) {
          clearInterval(state.currentTimerInterval);
          state.currentTimerInterval = null; // 必须置空，否则 startCurrentTimer 会认为还在跑
      }
      els.currentTimerVal.textContent = "0.0s";
      els.currentTimerRing.style.animationPlayState = 'paused';
      
      state.errorCount = 0;
      state.totalChars = 0;
      state.completed = false;
      state.lastInputVal = "";
      
      // 注意：不再重置 els.timerVal，它是总时间
      
      // 如果需要保持Combo，就不重置
      if (!keepCombo) {
        state.combo = 0;
      }
      updateComboDisplay();
      
      // 更新来源标签
      els.sourceTag.textContent = `来源：${state.targetSource}`;
      
      // 如果游戏还未正式开始（在开始界面），则不启动计时器和输入
      if (!state.gameStartTime) {
          renderText();
          return;
      }
      
      els.input.value = "";
      els.input.disabled = false;
      els.input.focus();
      
      updateDashboard(0, 0, 100);
      renderText();
      
      // 只要输入框获得焦点，就开始计时
      startCurrentTimer(); 
      
      // 启动60秒游戏结束计时器 (已在 startCurrentTimer 中集成，此处移除)
      if (state.gameOverTimer) clearTimeout(state.gameOverTimer);
      
      // 移除旧的分级慢速检测，统一由 startCurrentTimer 管理
      [10, 20, 30, 60].forEach(sec => {
          const timerKey = `slowCheckTimer${sec}`;
          if (state[timerKey]) clearTimeout(state[timerKey]);
      });
    }
    
    // 移除 startTimer 函数，因为现在是全局计时
    
    // 启动当前句计时器
    function startCurrentTimer() {
        // 如果已经有计时器在运行，先清除
        if (state.currentTimerInterval) {
            clearInterval(state.currentTimerInterval);
        }
        
        state.currentStartTime = Date.now();
        els.currentTimerRing.style.animationPlayState = 'running';
        
        state.currentTimerInterval = setInterval(() => {
            const elapsed = Date.now() - state.currentStartTime;
            const elapsedSeconds = Math.floor(elapsed / 1000);
            const secondsDisplay = (elapsed / 1000).toFixed(1);
            els.currentTimerVal.textContent = `${secondsDisplay}s`;
            
            // 超时检测 (例如超过60秒)
            if (elapsedSeconds > 60 && !state.completed) {
                triggerGameOver();
                return; // 结束函数执行
            }
            
            // 慢速检测 (每隔10秒嘲讽一下)
            // 只有当游戏未结束 且 Combo 小于 190 时才触发
            if (elapsedSeconds > 0 && elapsedSeconds % 10 === 0 && !state.completed && state.combo < 190) {
                 const key = `slowCheckTimer${elapsedSeconds}`;
                 if (!state[key]) {
                     state[key] = true;
                     
                     // 根据时间选择不同的文案库
                     let lib = [];
                     if (elapsedSeconds < 20) {
                         // 10s: level10 (index 0-9)
                         lib = mockeryLibV2.slice(0, 10);
                     } else if (elapsedSeconds < 30) {
                         // 20s: level20 (index 10-19)
                         lib = mockeryLibV2.slice(10, 20);
                     } else if (elapsedSeconds < 60) {
                         // 30s-50s: level30 (index 20-29)
                         lib = mockeryLibV2.slice(20, 30);
                     } else {
                         // 60s+: level60 (index 30-35)
                         lib = mockeryLibV2.slice(30, 36);
                     }
                     
                     if (lib.length > 0) {
                         const item = lib[Math.floor(Math.random() * lib.length)];
                         console.log(`Triggering slow mock voice: ${item.f} - ${item.t}`);
                         
                         // 10, 20, 30 秒同时播放铃声提示
                         if (elapsedSeconds <= 30) {
                             AudioEngine.playBell();
                         }
                         
                         // 播放语音
                         AudioEngine.playVoice(item.f);
                         // 不显示Toast，仅播放语音
                         // showToast(item.t, false);
                     }
                     
                     // 1秒后重置标记，防止下一帧重复触发
                     setTimeout(() => { state[key] = false; }, 1000);
                 }
            }
        }, 100);
    }

    function updateComboDisplay() {
        els.comboCount.textContent = state.combo;
        
        // 更新 Combo 进度条 (0-200)
        const progress = Math.min(state.combo / 200 * 100, 100);
        els.comboBar.style.width = `${progress}%`;
        
        // 激活尾焰效果
        if (state.combo > 0) {
            els.comboProgressArea.classList.add('active');
        } else {
            els.comboProgressArea.classList.remove('active');
        }

        // 点亮里程碑
        if (state.combo >= 100) {
            els.milestone100.classList.add('reached');
        } else {
            els.milestone100.classList.remove('reached');
        }

        if (state.combo >= 200) {
            els.milestone200.classList.add('reached');
        } else {
            els.milestone200.classList.remove('reached');
        }

        // 只有 combo > 2 才显示
        if (state.combo > 2) {
            els.comboContainer.classList.add('visible');
            els.comboContainer.classList.add('active');
            els.comboCount.classList.add('active'); // 增加透明度控制
            
            els.comboCount.classList.remove('pop');
            void els.comboCount.offsetWidth; // trigger reflow
            els.comboCount.classList.add('pop');
            
            if (state.combo > 20) {
                els.comboContainer.classList.add('burning');
            }
        } else {
            // 隐藏
            els.comboContainer.classList.remove('visible');
            els.comboCount.classList.remove('active');
            els.comboContainer.classList.remove('burning');
        }
    }

    function playComboSound(prevCombo, currentCombo) {
        if (!state.sfxEnabled) return;
        
        // 连击里程碑音效
        const prevMilestone = Math.floor(prevCombo / 10);
        const currentMilestone = Math.floor(currentCombo / 10);

        if (currentMilestone > prevMilestone && currentCombo > 0) {
            // 普通里程碑(10/20...) 不再播放铃声，保持安静
            // AudioEngine.playBell();
            
            // 如果跨越了 50 的倍数，额外加一个爆炸音效
            if (Math.floor(prevCombo / 50) < Math.floor(currentCombo / 50)) {
                setTimeout(() => AudioEngine.playExplosion(), 100);
            }
        }
    }

    function updateDashboard(currentLen, wpm, accuracy) {
      const total = state.targetText.length;
      
      // 更新进度
      els.progressText.textContent = `${currentLen}/${total}`;
      const progressOffset = CIRCLE_CIRCUMFERENCE - (currentLen / total) * CIRCLE_CIRCUMFERENCE;
      els.progressCircle.style.strokeDashoffset = progressOffset;

      // 更新WPM (假设满分120WPM)
      els.wpm.textContent = wpm;
      const wpmPercent = Math.min(wpm / 120, 1);
      const wpmOffset = CIRCLE_CIRCUMFERENCE - wpmPercent * CIRCLE_CIRCUMFERENCE;
      els.wpmCircle.style.strokeDashoffset = wpmOffset;

      // 更新准确率
      els.accuracy.textContent = `${accuracy}%`;
      const accOffset = CIRCLE_CIRCUMFERENCE - (accuracy / 100) * CIRCLE_CIRCUMFERENCE;
      els.accuracyCircle.style.strokeDashoffset = accOffset;
    }

    function renderText(currentInput = "") {
      const target = state.targetText;
      const pinyinList = state.targetPinyin || [];
      let html = "";
      
      for (let i = 0; i < target.length; i++) {
        const char = target[i];
        const py = pinyinList[i] || '';
        let boxClass = "";
        
        if (i < currentInput.length) {
          if (currentInput[i] === char) {
            boxClass = "correct";
          } else {
            boxClass = "wrong";
          }
        } else if (i === currentInput.length) {
          boxClass = "current";
        }
        
        html += `
        <div class="char-box ${boxClass}">
            <div class="pinyin">${py}</div>
            <div class="char">${char}</div>
        </div>`;
      }
      
      els.textDisplay.innerHTML = html;
    }

    function showError(isError) {
      if (isError) {
        els.input.classList.add("error");
        
        // 随机选择一句嘲讽
        const item = mockeryLibV2[Math.floor(Math.random() * mockeryLibV2.length)];
        
        // 仅播放语音，不显示文字
        AudioEngine.playVoice(item.f);
      } else {
        els.input.classList.remove("error");
      }
    }

    function showToast(msg, isSuccess = false) {
      els.toast.textContent = msg;
      els.toast.className = `toast show ${isSuccess ? 'success' : ''}`;
      if (els.toast.timeout) clearTimeout(els.toast.timeout);
      els.toast.timeout = setTimeout(() => {
        els.toast.className = "toast";
      }, isSuccess ? 4500 : 2000); // 成功提示显示更久 (4.5s)
    }

    function updateSessionStats(lastWpm, lastAcc) {
      state.session.completedCount++;
      state.session.totalWpm += lastWpm;
      state.session.totalAcc += lastAcc;
      
      const avgWpm = Math.round(state.session.totalWpm / state.session.completedCount);
      const avgAcc = Math.round(state.session.totalAcc / state.session.completedCount);
      
      els.avgWpm.textContent = avgWpm;
      const wpmPercent = Math.min(avgWpm / 120, 1);
      const wpmOffset = CIRCLE_CIRCUMFERENCE_SMALL - wpmPercent * CIRCLE_CIRCUMFERENCE_SMALL;
      els.avgWpmCircle.style.strokeDashoffset = wpmOffset;
      
      els.avgAcc.textContent = `${avgAcc}%`;
      const accOffset = CIRCLE_CIRCUMFERENCE_SMALL - (avgAcc / 100) * CIRCLE_CIRCUMFERENCE_SMALL;
      els.avgAccCircle.style.strokeDashoffset = accOffset;
    }

    function complete() {
      state.completed = true;
      els.input.disabled = true;
      
      // 清除所有慢速检测定时器
      [10, 20, 30, 60].forEach(sec => {
          const timerKey = `slowCheckTimer${sec}`;
          if (state[timerKey]) clearTimeout(state[timerKey]);
      });
      
      if (state.currentTimerInterval) clearInterval(state.currentTimerInterval); // 停止当前计时
      els.currentTimerRing.style.animationPlayState = 'paused';
      
      // 计算并更新本局统计
      let wpm = 0;
      if (state.startTime && state.lastInputVal.length > 0) {
        const elapsedMin = (Date.now() - state.startTime) / 1000 / 60;
        wpm = Math.round(state.lastInputVal.length / elapsedMin) || 0;
      }
      const accuracy = Math.max(0, 100 - (state.errorCount * 2));
      updateSessionStats(wpm, accuracy);

      // 触发高级爆炸音效
      AudioEngine.playExplosion();
      
      startFireworks();
      
      // 这里的耗时提示，依然是针对单句的
      const elapsedSec = Math.floor((Date.now() - state.startTime) / 1000);
      const minutes = Math.floor(elapsedSec / 60);
      const seconds = elapsedSec % 60;
      let timeStr = "";
      if (minutes > 0) timeStr += `${minutes}分`;
      timeStr += `${seconds}秒`;
      
      const humorMsg = `耗时${timeStr}，你没有浪费生命，因为你用它们把键盘敲出了火花！`;
      const humorMsg2 = `耗时${timeStr}，这手速，建议去申请吉尼斯世界纪录（如果他们收的话）。`;
      const humorMsg3 = `仅仅用了${timeStr}，键盘都还没反应过来就被你征服了。`;
      const humorMsg4 = `耗时${timeStr}，你的指尖在跳舞，键盘在为你伴奏。`;
      const humorMsg5 = `耗时${timeStr}，这种效率，老板看了都要感动流泪。`;
      
      // 混合之前的夸奖库
      // 确保真人语音和文字是匹配的
      const item = praiseLibV2[Math.floor(Math.random() * praiseLibV2.length)];
      
      // 最终决定：为了避免语音文字“内容不匹配”的感觉，我们让 Toast 显示耗时统计（这是语音没有的），
      // 而语音播放鼓励语（这是文字没有的），两者互补。
      // 修正：用户要求彻底隐藏鼓励文字，只保留声音
      // const statsMsg = [humorMsg, humorMsg2, humorMsg3, humorMsg4, humorMsg5][Math.floor(Math.random() * 5)];
      // showToast(statsMsg, true);
      
      AudioEngine.playVoice(item.f);
      
      // 1. 快速进入下一关 (1秒后)，不打断输入节奏
      setTimeout(() => {
        init(true); // 传入 true 以保持 Combo
      }, 1000); 

      // 2. 延迟关闭特效 (4秒后)，保证能看到烟花和文案
      if (state.stopEffectsTimer) clearTimeout(state.stopEffectsTimer);
      state.stopEffectsTimer = setTimeout(() => {
        stopFireworks();
      }, 4000);
    }

    // --- 5. 事件监听与输入处理 ---
    
    // 绑定顶部控制按钮
    document.getElementById('btn-restart-game').addEventListener('click', () => {
        // 增加点击动画反馈
        const btn = document.getElementById('btn-restart-game');
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => btn.style.transform = 'scale(1)', 100);
        restartGame();
    });

    document.getElementById('btn-quit-game').addEventListener('click', () => {
        const btn = document.getElementById('btn-quit-game');
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => btn.style.transform = 'scale(1)', 100);
        
        // 尝试关闭窗口 (需要 Electron 环境支持)
        if (window.close) {
            window.close();
        } else {
            alert('在浏览器中无法直接退出，请直接关闭标签页。');
        }
    });

    // --- 终极胜利逻辑 ---
    function triggerUltimateWin() {
        if (state.completed) return; // 防止重复触发
        state.completed = true;
        els.input.disabled = true;

        // 停止总计时器
        if (state.gameTimerInterval) clearInterval(state.gameTimerInterval);
        els.timerRing.style.animationPlayState = 'paused';
        
        // 停止当前句计时器 (彻底防止嘲讽)
        if (state.currentTimerInterval) clearInterval(state.currentTimerInterval);
        els.currentTimerRing.style.animationPlayState = 'paused';

        // 暂停背景音乐
        if (state.bgmEnabled) {
            AudioEngine.stopBgm();
        }

        // 1. 播放音效
        if (state.sfxEnabled) {
            AudioEngine.playExplosion();
            setTimeout(() => AudioEngine.playExplosion(), 300);
            setTimeout(() => AudioEngine.playExplosion(), 600);
            // 播放胜利和弦
            const Cmaj = [523.25, 659.25, 783.99, 1046.50];
            setTimeout(() => AudioEngine.playChord(Cmaj, 'triangle', 2.0), 800);
        }

        // 2. 界面元素炸裂
        const targets = ['.header-area', '.dashboard', '.practice-area', '.keyboard-wrapper', '.audio-controls'];
        targets.forEach(selector => {
            const el = document.querySelector(selector);
            if (el) el.classList.add('explode-out');
        });

        // 3. 显示胜利文字
        const overlay = document.getElementById('victory-overlay');
        const victoryTitle = overlay.querySelector('.victory-title');
        
        // 计算总耗时
        const elapsed = Date.now() - state.gameStartTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        let timeStr = "";
        if (minutes > 0) timeStr += `${minutes}分`;
        timeStr += `${seconds}秒`;
        
        // 随机生成一段关于时间的鼓励语 (强调没有浪费时间)
        const encouragements = [
            `你没有浪费这段时间，因为你刚刚点亮了思维的火花！`,
            `这${timeStr}，比刷短视频有意义多了！`,
            `用${timeStr}换来指尖的极致体验，这波血赚！`,
            `这段时间没有虚度，你的大脑正在感谢你的锻炼！`,
            `专注的${timeStr}，是你对抗无聊世界的最好武器。`,
            `你的手速已超越 99% 的人类，这${timeStr}值了！`,
            `时间就是金钱，但这${timeStr}是无价的快乐。`,
            `每一次敲击都在证明，这${timeStr}充满价值。`,
            `你用${timeStr}不仅练了手速，还净化了灵魂。`,
            `这${timeStr}，键盘在歌唱，你在发光。`
        ];
        const randomMsg = encouragements[Math.floor(Math.random() * encouragements.length)];
        
        // 播放终极胜利语音 (需用户自行添加文件)
        // 为了避免报错，这里先做个检查或 try-catch
        try {
            AudioEngine.playVoice('ultimate_win');
        } catch (e) {
            console.warn("未找到 ultimate_win.mp3，请用户自行生成并添加。");
        }
        
        victoryTitle.innerHTML = `恭喜你<br>成为了打字英雄！<div style="font-size: 30px; margin-top: 20px; color: #fff;">总耗时：${timeStr}<br>${randomMsg}</div>`;
        
        setTimeout(() => {
            overlay.classList.add('show');
            startFireworks(); // 满屏烟花
        }, 1000);
    }

    // 游戏结束 (超时失败)
    function triggerGameOver() {
        if (state.completed) return;
        state.completed = true;
        els.input.disabled = true;
        
        // 停止计时器
        if (state.currentTimerInterval) clearInterval(state.currentTimerInterval);
        els.currentTimerRing.style.animationPlayState = 'paused';
        
        // 切换BGM
        if (state.bgmEnabled) {
            AudioEngine.switchBgm('gameover');
        }
        
        const overlay = document.getElementById('victory-overlay');
        const victoryTitle = overlay.querySelector('.victory-title');
        
        // 随机选择一句失败嘲讽，并播放对应语音
        const item = gameOverMockeryV2[Math.floor(Math.random() * gameOverMockeryV2.length)];
        AudioEngine.playVoice(item.f);
        
        victoryTitle.innerHTML = `<span style="color: #ff5252; text-shadow: 0 0 20px rgba(255,0,0,0.5);">游戏结束</span><br><div style="font-size: 24px; margin-top: 20px; color: #fff;">耗时超过1分钟<br>${item.t}</div>`;
        
        overlay.classList.add('show');
    }

    // 重新开始
    const restartGame = () => {
        const overlay = document.getElementById('victory-overlay');
        overlay.classList.remove('show');
        
        // 恢复胜利标题
        const victoryTitle = overlay.querySelector('.victory-title');
        victoryTitle.innerHTML = '恭喜你<br>成为了打字英雄！';
        
        // 清除游戏结束计时器
        if (state.gameOverTimer) clearTimeout(state.gameOverTimer);
        
        // 恢复界面元素
        const targets = ['.header-area', '.dashboard', '.practice-area', '.keyboard-wrapper', '.audio-controls'];
        targets.forEach(selector => {
            const el = document.querySelector(selector);
            if (el) {
                el.classList.remove('explode-out');
                // 强制重绘以重置动画
                void el.offsetWidth;
            }
        });

        stopFireworks();

        // 恢复初始背景音乐 (圆舞曲)
        if (state.bgmEnabled) {
            AudioEngine.switchBgm('default');
            AudioEngine.startBgm();
        }

        // 重置总时间
        state.gameStartTime = Date.now();
        els.timerVal.textContent = "00:00";
        els.timerRing.style.animationPlayState = 'running';
        
        // 重启总计时器
        if (state.gameTimerInterval) clearInterval(state.gameTimerInterval);
        state.gameTimerInterval = setInterval(() => {
            const elapsed = Date.now() - state.gameStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            els.timerVal.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 100);
        
        init(); // 重置游戏
    };

    document.getElementById('restart-btn').addEventListener('click', restartGame);
    
    // 监听全局回车键以重启 (仅在胜利界面显示时)
    window.addEventListener('keydown', (e) => {
        const overlay = document.getElementById('victory-overlay');
        if (e.key === 'Enter' && overlay && overlay.classList.contains('show')) {
            restartGame();
        }
    });

    // 监听拼音输入法状态
    els.input.addEventListener("compositionstart", () => {
      state.isComposing = true;
      // 第一次交互初始化音频上下文
      AudioEngine.init();
    });

    els.input.addEventListener("compositionend", (e) => {
      state.isComposing = false;
      validateInput(e.target.value);
    });

    els.input.addEventListener("input", (e) => {
      if (!state.isComposing) {
        validateInput(e.target.value);
      }
    });
    
    // 点击页面任意位置也初始化音频，防止自动播放策略限制
    document.addEventListener('click', () => {
      AudioEngine.init();
    }, { once: true });

    function validateInput(val) {
      if (state.completed) return;

      // 1. 开始计时 (单句 WPM 计算用)
      if (!state.startTime && val.length > 0) {
        state.startTime = Date.now();
        // 确保音频引擎就绪
        AudioEngine.init(); 
      }

      // 2. 核心校验逻辑
      const target = state.targetText;
      let isCorrectPrefix = true;
      
      for (let i = 0; i < val.length; i++) {
        if (val[i] !== target[i]) {
          isCorrectPrefix = false;
          break;
        }
      }

      if (!isCorrectPrefix) {
        // 只有当输入长度增加（即新输入了错误字符）时，才触发错误提示
        const diff = val.length - state.lastInputVal.length;
        if (diff > 0) {
            showError(true);
            state.errorCount++;
            state.combo = 0; 
            AudioEngine.playError();
        } else {
            // 如果是删除操作 (diff < 0) 或者是替换操作，不重新触发错误提示，但保持红色状态
            if (els.input.classList.contains("error")) {
                // do nothing, keep red
            }
        }
      } else {
        showError(false);
        // 如果输入增加了长度，且是正确的，则增加 combo (按增加的字数计算)
        const diff = val.length - state.lastInputVal.length;
        if (diff > 0) {
            const oldCombo = state.combo;
            state.combo += diff;
            playComboSound(oldCombo, state.combo);
            
            // 检查音乐切换条件
            // 1. 0 -> 100: 切换到 土耳其进行曲
            if (state.combo >= 100 && oldCombo < 100) {
                AudioEngine.switchBgm('turkish');
            }
            // 2. 100 -> 150: 切换到 悲怆 V3
            if (state.combo >= 150 && oldCombo < 150) {
                AudioEngine.switchBgm('v3');
            }
            
            // 检查终极胜利条件
            if (state.combo >= 200) {
                triggerUltimateWin();
            }
        } else if (diff < 0) {
             // 删除操作不重置 Combo，但也不增加
        }
      }
      
      updateComboDisplay();

      let wpm = 0;
      if (state.startTime && val.length > 0) {
        const elapsedMin = (Date.now() - state.startTime) / 1000 / 60;
        if (elapsedMin <= 0) {
            wpm = 999;
        } else {
            wpm = Math.round(val.length / elapsedMin);
            if (wpm === Infinity || wpm > 999) wpm = 999;
        }
      }
      const accuracy = Math.max(0, 100 - (state.errorCount * 2));

      renderText(val);
      updateDashboard(val.length, wpm, accuracy);
      state.lastInputVal = val;

      if (val === target) {
        complete();
      }
    }

    // 键盘视觉效果
    const keys = document.querySelectorAll(".key");
    const keyMap = {};
    keys.forEach(key => keyMap[key.getAttribute("data-key")] = key);

    function highlightKey(code) {
        const key = keyMap[code];
        if (!key) return;
        key.classList.add("active");
        setTimeout(() => key.classList.remove("active"), 120);
        
        // 触发火星特效
        const rect = key.getBoundingClientRect();
        createKeySparks(rect);
    }

    window.addEventListener("keydown", (e) => {
        // 播放键盘音效
        AudioEngine.playClick();

        const k = e.key;
        if (k.length === 1) highlightKey(k.toLowerCase());
        else if (k === "Tab") { e.preventDefault(); highlightKey("tab"); }
        else if (k === "CapsLock") highlightKey("capslock");
        else if (k === "Enter") highlightKey("enter");
        else if (k === "Shift") { highlightKey("shift"); highlightKey("shift-right"); }
        else if (k === "Control") { highlightKey("ctrl"); highlightKey("ctrl-right"); }
        else if (k === "Alt") { highlightKey("alt"); highlightKey("alt-right"); }
    });

    // --- 6. 烟花与火星特效 ---
    const canvas = els.canvas;
    const ctx = canvas.getContext('2d');
    let fireworksAnim;
    let particles = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Particle {
      constructor(x, y, color, velocityScale = 1) {
        this.x = x;
        this.y = y;
        this.color = color;
        const angle = Math.random() * Math.PI * 2;
        const velocity = (Math.random() * 4 + 1) * velocityScale;
        this.vx = Math.cos(angle) * velocity;
        this.vy = Math.sin(angle) * velocity;
        this.alpha = 1;
        this.decay = Math.random() * 0.015 + 0.015;
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.05; 
        this.alpha -= this.decay;
      }
      draw() {
        ctx.globalAlpha = Math.max(0, this.alpha);
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function createFirework() {
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height * 0.5;
      const color = `hsl(${Math.random() * 360}, 100%, 60%)`;
      for (let i = 0; i < 50; i++) {
        particles.push(new Particle(x, y, color));
      }
    }

    // 按键火星
    function createKeySparks(rect) {
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      // 纯红色粒子效果
      const colors = ['#ff0000', '#ff3333', '#cc0000', '#ff1a1a']; 
      
      for (let i = 0; i < 12; i++) {
        const color = colors[Math.floor(Math.random() * colors.length)];
        const p = new Particle(centerX, centerY, color, 1.5);
        // 调整为向上喷射
        const angle = -Math.PI / 2 + (Math.random() - 0.5) * 1.5; // 上方扇形
        const velocity = Math.random() * 6 + 2;
        p.vx = Math.cos(angle) * velocity;
        p.vy = Math.sin(angle) * velocity;
        p.decay = Math.random() * 0.03 + 0.02; // 消失得快
        particles.push(p);
      }
      
      if (!fireworksAnim) animateFireworks();
    }

    function animateFireworks() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // 只有在完成状态才自动放烟花
      if (state.completed && Math.random() < 0.05) createFirework();
      
      particles = particles.filter(p => p.alpha > 0);
      particles.forEach(p => { p.update(); p.draw(); });
      
      if (particles.length > 0 || state.completed) {
         fireworksAnim = requestAnimationFrame(animateFireworks);
      } else {
         fireworksAnim = null;
      }
    }

    function startFireworks() {
      particles = [];
      cancelAnimationFrame(fireworksAnim);
      fireworksAnim = null; // 确保清除
      animateFireworks();
    }

    function stopFireworks() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles = [];
      cancelAnimationFrame(fireworksAnim);
      fireworksAnim = null; // 关键修复：重置动画ID，否则下次按键无法启动循环
    }

    // --- 7. 键盘火焰特效 (Canvas) ---
    const fireCanvas = document.getElementById('keyboard-fire');
    const fireCtx = fireCanvas.getContext('2d');
    let fireParticles = [];
    
    // 调整火焰画布大小
    function resizeFireCanvas() {
        fireCanvas.width = window.innerWidth;
        fireCanvas.height = window.innerHeight;
    }
    
    window.addEventListener('resize', resizeFireCanvas);
    
    // 火焰粒子类
    class FireParticle {
        constructor() {
            this.life = 0; // 初始为死亡状态，等待 Combo 激活
        }
        
        reset() {
            const wrapper = document.querySelector('.keyboard-wrapper');
            if (!wrapper) return;
            const rect = wrapper.getBoundingClientRect();
            
            // 计算基于 combo 的强度 (10-100+)
            const intensity = Math.min((state.combo - 10) / 40, 2); // 0 -> 2
            
            // 随机选择生成位置
            const side = Math.random();
            const pad = 10;
            
            // 扩散范围随 combo 增大
            const spread = 20 * intensity;
            
            if (side < 0.6) { // 60% 底部
                this.x = rect.left + Math.random() * rect.width;
                this.y = rect.bottom - pad; 
                this.vy = -(Math.random() * (3 + intensity * 2) + 2); // 向上速度
            } else if (side < 0.8) { // 20% 左侧
                this.x = rect.left + pad;
                this.y = rect.top + Math.random() * rect.height;
                this.vy = -(Math.random() * (2 + intensity) + 1);
            } else { // 20% 右侧
                this.x = rect.right - pad;
                this.y = rect.top + Math.random() * rect.height;
                this.vy = -(Math.random() * (2 + intensity) + 1);
            }
            
            // 向外扩散一点
            if (side >= 0.6) {
                this.x += (side < 0.8 ? -spread : spread) * Math.random();
            }
            
            this.vx = (Math.random() - 0.5) * (1.5 + intensity); // 左右摇摆幅度加大
            this.size = (Math.random() * 10 + 5) * (1 + intensity * 0.5); // 基础大小随 combo 增大
            this.life = 1.0;
            this.decay = Math.random() * 0.03 + 0.015;
            
            // 颜色逻辑：随 Combo 变化
            // Combo < 50: 橙红火焰 (Hue 0-30)
            // Combo 50-100: 蓝火 (Hue 200-240)
            // Combo 100-150: 紫火 (Hue 260-300)
            // Combo > 150: 金橙神火 (Hue 30-50, 极高亮度)
            
            if (state.combo < 50) {
                this.colorH = Math.random() * 20 + 0; // 0-20 (Red-Orange)
                this.colorS = 100;
                this.colorL = 60 + intensity * 10;
            } else if (state.combo < 100) {
                this.colorH = Math.random() * 30 + 200; // 200-230 (Blue)
                this.colorS = 100;
                this.colorL = 60 + intensity * 10;
            } else if (state.combo < 150) {
                this.colorH = Math.random() * 40 + 260; // 260-300 (Purple)
                this.colorS = 100;
                this.colorL = 70 + intensity * 10;
            } else {
                // 金橙色神火
                this.colorH = Math.random() * 20 + 30; // 30-50 (Gold/Orange)
                this.colorS = 100;
                this.colorL = 80 + Math.random() * 20; // 极亮
            }
        }
        
        update() {
            // 活着的粒子
            if (this.life > 0) {
                this.x += this.vx;
                this.y += this.vy;
                this.size -= 0.2; 
                this.life -= this.decay;
                
                // 颜色随生命周期变深
                if (this.life < 0.8) this.colorL = 50; 
                if (this.life < 0.5) { this.colorL = 40; }
                if (this.life < 0.3) { this.colorL = 30; this.colorS = 20; } // 灰黑烟雾
                
                // 扰动
                this.vx += (Math.random() - 0.5) * 0.3;
            }
            
            // 重生逻辑：必须满足 Combo > 10
            // 且生成概率随 combo 增加
            if (this.life <= 0 || this.size <= 0) {
                const spawnRate = Math.min(0.05 + (state.combo - 10) * 0.005, 0.3); // 最大 30% 概率每帧重生
                
                // 关键修改：游戏完成后 (state.completed) 不再生成新火焰粒子
                if (state.combo > 10 && Math.random() < spawnRate && !state.completed) { 
                    this.reset();
                } else {
                    this.life = 0; 
                }
            }
        }
        
        draw() {
            if (this.life <= 0) return;
            
            fireCtx.globalAlpha = Math.max(0, this.life);
            fireCtx.fillStyle = `hsl(${this.colorH}, ${this.colorS}%, ${this.colorL}%)`;
            fireCtx.beginPath();
            
            // 绘制火苗形状
            fireCtx.moveTo(this.x, this.y - this.size * 2); 
            
            fireCtx.bezierCurveTo(
                this.x + this.size, this.y - this.size * 0.5,
                this.x + this.size, this.y + this.size,
                this.x, this.y + this.size
            );
            
            fireCtx.bezierCurveTo(
                this.x - this.size, this.y + this.size,
                this.x - this.size, this.y - this.size * 0.5,
                this.x, this.y - this.size * 2
            );
            
            fireCtx.fill();
            // 浅色背景下不需要 lighter 混合模式，否则会变白看不见
            fireCtx.globalCompositeOperation = 'source-over';
        }
    }
    
    // 初始化火焰
    function initFire() {
        resizeFireCanvas();
        for(let i=0; i<300; i++) {
            const p = new FireParticle();
            p.life = 0; 
            fireParticles.push(p);
        }
        animateFire();
    }
    
    function animateFire() {
        fireCtx.clearRect(0, 0, fireCanvas.width, fireCanvas.height);
        fireCtx.globalCompositeOperation = 'source-over'; 
        
        fireParticles.forEach(p => {
            p.update();
            p.draw();
        });
        
        requestAnimationFrame(animateFire);
    }
    
    // 启动火焰
    initFire();

    init();
  </script>
</body>
</html>

# 打字英雄 APP_FLOW - 应用页面与用户流程

本文件用「纯中文」描述整个应用的页面结构和用户路径，不涉及具体代码实现，方便对产品流程一眼看懂，也方便后续让 AI 按流程实现或重构。

## 1. 主要页面 / 状态

目前应用基本在一个窗口中完成，主要有这些可视状态：

1. **启动 / 封面状态**
   - 顶部展示「打字英雄」Logo、连击火焰组件。
   - 居中显示开始遮罩层（Start Overlay），文案类似「准备好开始这场热血的指尖冒险了吗？」。
   - 中心有「按 Enter 键开始冒险」按钮。

2. **练习状态（游戏主界面）**
   - 左上角：Logo + Combo 火焰组件。
   - 右上角：控制按钮（重新开始、BGM 开关、音效开关等）。
   - 上方：进度条 + WPM / 准确率 / 已完成句数等仪表盘。
   - 中间：当前练习的诗句文本（带来源标签）。
   - 中下：输入框。
   - 底部：虚拟键盘 + 按键粒子特效画布。

3. **胜利遮罩层（终极胜利状态）**
   - 当 Combo 达到 200 时会出现。
   - 全屏烟花特效，中央显示大号「恭喜你成为了打字英雄！」文案。
   - 显示「重新开始」按钮和提示「按 Enter 键重新开始」。

4. **游戏结束状态（失败）**
   - 暂不单独用页面实现，而是通过：
     - 语音提示（例如遗憾文案）；
     - 停止当前输入句的计时与进度更新；
     - 可考虑未来扩展为单独的「Game Over」遮罩层。

## 2. 全局流程（从启动到多句练习）

1. **启动应用**
   - Electron 打开窗口，加载 keyboard.html。
   - 默认显示启动遮罩层，背景可能轻微动效。

2. **开始第一局练习**
   - 用户点击「开始冒险」按钮，或按 Enter 键：
     - 隐藏启动遮罩层；
     - 初始化游戏状态（连击数、统计面板、计时器等）；
     - 随机抽取一条诗句，渲染到文本区域；
     - 输入框自动获得焦点。

3. **持续练习 / 切换句子**
   - 对于每一句：
     1. 展示目标文本和来源；
     2. 用户使用中文输入法输入；
     3. 实时校验前缀正确性、更新 Combo / WPM / 准确率；
     4. 当整句完全输入正确：
        - 触发烟花和夸奖语音；
        - 短暂停顿后自动加载下一句（保持 Combo）。

4. **终极胜利**
   - 当连续 Combo 累积达到 200：
     - 触发终极胜利遮罩层；
     - 显示「打字英雄」称号，播放专属语音和 BGM；
     - 用户可以点击按钮或按 Enter 键重新开始。

5. **游戏结束（慢速或超时）**
   - 单句耗时超过 60 秒：
     - 触发游戏结束判定；
     - 播放结束语音和音效；
     - 停止本句计时和输入判定；
     - 用户可选择重开或关闭应用。

## 3. 关键交互流程（按功能拆分）

### 3.1 开始 / 重开流程

- **开始游戏**
  - 触发条件：
    - 点击启动遮罩层上的按钮；
    - 或按键盘 Enter 键（在启动遮罩显示状态下）。
  - 行为：
    - 初始化游戏状态；
    - 隐藏启动遮罩层；
    - 加载第一句文本；
    - 输入框获取焦点。

- **重开当前局**
  - 触发条件：
    - 右上角点击「重新开始本局」按钮；
    - 或在胜利遮罩层按 Enter 键 / 点击「重新开始」按钮。
  - 行为：
    - 清空当前统计与 Combo；
    - 重新从素材库抽取新句子（或从头开始）。

### 3.2 输入与反馈流程

1. 用户在输入框输入（支持中文输入法）：
   - 处于拼音组合阶段时：
     - 不进行正式的前缀校验；
     - 只做光标和按键特效（音效 + 粒子）。
   - 选词上屏后：
     - 触发前缀校验逻辑；
     - 如正确，则更新绿色高亮、Combo 值和仪表盘；
     - 如错误且是新增字符，则触发错误效果和语音。

2. 对每个字符输入：
   - 虚拟键盘对应按键高亮，并在按键位置生成火花粒子；
   - 同时播放键盘敲击音效（受全局音效开关控制）。

3. 句子完成后：
   - 文本全部高亮为「完成态」；
   - 触发烟花、夸奖语音和适当的 Combo 火焰增强；
   - 本句结束统计可在仪表盘中更新；
   - 自动进入下一句。

### 3.3 慢速与嘲讽流程

- 对当前句子：
  - 从开始输入起开始计时；
  - 在 10s / 20s / 30s 时：
    - 如果用户仍在本句且 Combo 不高（例如 < 190）：
      - 播放对应等级的嘲讽或催促语音；
  - 在 60s 时：
    - 触发游戏结束；
    - 播放结束语音与错误音效。

### 3.4 音频开关流程

- 顶部控制区域提供：
  - BGM 开关；
  - SFX（音效）开关。

- 开关逻辑：
  - 用户点击后：
    - 切换按钮状态样式；
    - 调用 AudioEngine 内部的开关逻辑；
    - BGM 开关影响背景音乐播放；
    - SFX 开关影响键盘声、错误音、烟花声等。

## 4. 输入法（IME）兼容流程（高层）

> 详细技术实现请看代码和技术文档，这里只用流程语言描述「应该发生什么」，方便后续约束实现。

1. 用户使用中文输入法（例如搜狗拼音）时：
   - 在拼音阶段，按键需要有声音和粒子反馈；
   - 选择候选词上屏后，再进行前缀正确性判断；
   - 不允许因为组合输入而多次错误判定。

2. 系统需要区分：
   - 纯拼音操作（候选框内）；
   - 真正上屏的汉字内容；
   - 删除操作（退格）；
   - 选择候选词确认（空格 / 数字键）。

3. 流程目标：
   - **体验上**：用户感觉「无论是拼音还是汉字，手感都是一致的，有声音、有特效」；
   - **逻辑上**：真正的正确/错误判定只基于上屏后的汉字序列。

## 5. 将来可能扩展的页面 / 流程

以下内容目前还没有实现，只作为后续扩展时的占位说明：

1. **关卡选择页面**
   - 用户可以选择不同难度的关卡（短句、长句、指定诗人等）。

2. **统计与成就页面**
   - 展示历史练习记录、最高连击、平均 WPM 等；
   - 解锁式成就勋章（如「连续 3 天练习」）。

3. **设置页面**
   - 配置 BGM 音量、SFX 音量、语音风格（毒舌 / 暖心）；
   - 切换不同键盘主题皮肤。

当未来增加这些功能时，可以在本文件中继续补充对应的流程描述，用来约束实现和测试。

